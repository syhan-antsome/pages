<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#xc18c;&#xc15c; &#xb85c;&#xadf8;&#xc778; &amp; &#xc18c;&#xc15c; &#xd68c;&#xc6d0;&#xac00;&#xc785; &#xc808;&#xcc28; &#xb3c4;&#xc2dd;&#xd654;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="소셜-로그인--소셜-회원가입-절차-도식화">소셜 로그인 &amp; 소셜 회원가입 절차 도식화</h1>
<h2 id="️-보안-주의사항">⚠️ 보안 주의사항</h2>
<p><strong>중요</strong>: 이 문서의 모든 API 키와 시크릿 값들은 예시용 플레이스홀더입니다.</p>
<ul>
<li>실제 운영 환경에서는 반드시 본인의 실제 키값을 사용하세요</li>
<li>모든 민감한 정보는 환경 변수(<code>.env</code> 파일)로 관리하세요</li>
<li>이런 민감한 정보는 절대 버전 관리 시스템(Git)에 커밋하지 마세요</li>
</ul>
<h2 id="-목차">📋 목차</h2>
<ol>
<li><a href="#%EC%A0%84%EC%B2%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EA%B0%9C%EC%9A%94">전체 아키텍처 개요</a></li>
<li><a href="#%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B5%AC%ED%98%84-%EC%84%B8%EB%B6%80%EC%82%AC%ED%95%AD">백엔드 구현 세부사항</a></li>
<li><a href="#%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%EA%B5%AC%ED%98%84-%EA%B0%80%EC%9D%B4%EB%93%9C">프론트엔드 구현 가이드</a></li>
<li><a href="#%ED%94%8C%EB%9E%AB%ED%8F%BC%EB%B3%84-%EC%83%81%EC%84%B8-%ED%94%8C%EB%A1%9C%EC%9A%B0">플랫폼별 상세 플로우</a></li>
<li><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B5%AC%EC%A1%B0-%EB%B0%8F-api-%EC%8A%A4%ED%8E%99">데이터 구조 및 API 스펙</a></li>
<li><a href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%B0%8F-%EB%94%94%EB%B2%84%EA%B9%85-%EA%B0%80%EC%9D%B4%EB%93%9C">테스트 및 디버깅 가이드</a></li>
</ol>
<hr>
<h2 id="️-전체-아키텍처-개요">🏗️ 전체 아키텍처 개요</h2>
<h3 id="시스템-구조">시스템 구조</h3>
<pre class="mermaid">graph TB
    subgraph &quot;프론트엔드 계층&quot;
        WEB[웹 브라우저]
        MOBILE[모바일 앱]
        ADMIN[관리자 페이지]
    end
    
    subgraph &quot;소셜 플랫폼&quot;
        GOOGLE[Google OAuth 2.0]
        KAKAO[카카오 로그인]
        NAVER[네이버 로그인]
    end
    
    subgraph &quot;AuthService (포트: 8082)&quot;
        CONTROLLER[SocialAuthController]
        SERVICE[SocialAuthService]
        GOOGLE_SVC[GoogleAuthService]
        KAKAO_SVC[KakaoAuthService]
        NAVER_SVC[NaverAuthService]
        USER_SVC[SocialUserService]
    end
    
    subgraph &quot;데이터 저장소&quot;
        MYSQL[(MySQL Database)]
        REDIS[(Redis Cache)]
    end
    
    WEB --&gt; CONTROLLER
    MOBILE --&gt; CONTROLLER
    ADMIN --&gt; CONTROLLER
    
    CONTROLLER --&gt; SERVICE
    SERVICE --&gt; GOOGLE_SVC
    SERVICE --&gt; KAKAO_SVC
    SERVICE --&gt; NAVER_SVC
    SERVICE --&gt; USER_SVC
    
    GOOGLE_SVC --&gt; GOOGLE
    KAKAO_SVC --&gt; KAKAO
    NAVER_SVC --&gt; NAVER
    
    USER_SVC --&gt; MYSQL
    SERVICE --&gt; REDIS
</pre>
<h3 id="핵심-개념-통합-소셜-인증-시스템">핵심 개념: 통합 소셜 인증 시스템</h3>
<ul>
<li><strong>하나의 엔드포인트</strong>: <code>/api/auth/social/{provider}</code> (GET/POST)</li>
<li><strong>자동 판단 로직</strong>: 로그인/회원가입을 서버가 자동 결정</li>
<li><strong>3단계 우선순위</strong>: 소셜ID → 이메일 → 신규생성</li>
</ul>
<hr>
<h2 id="-백엔드-구현-세부사항">🔧 백엔드 구현 세부사항</h2>
<h3 id="1-컨트롤러-계층-socialauthcontroller">1. 컨트롤러 계층 (SocialAuthController)</h3>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.controller.SocialAuthController</code></p>
<p><strong>주요 엔드포인트</strong>:</p>
<pre><code class="language-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/api/auth/social&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SocialAuthController</span> {
    
    <span class="hljs-comment">// 1. 통합 API 엔드포인트들</span>
    <span class="hljs-meta">@PostMapping(&quot;/google&quot;)</span>    <span class="hljs-comment">// Google ID Token 처리</span>
    <span class="hljs-meta">@PostMapping(&quot;/kakao&quot;)</span>     <span class="hljs-comment">// Kakao Access Token 처리  </span>
    <span class="hljs-meta">@PostMapping(&quot;/naver&quot;)</span>     <span class="hljs-comment">// Naver Access Token 처리</span>
    <span class="hljs-meta">@PostMapping(&quot;/signup&quot;)</span>    <span class="hljs-comment">// 소셜 회원가입 통합 처리</span>
    
    <span class="hljs-comment">// 2. 네이버 OAuth 플로우 (팝업 전용)</span>
    <span class="hljs-meta">@GetMapping(&quot;/naver/login&quot;)</span>      <span class="hljs-comment">// 네이버 인증 시작</span>
    <span class="hljs-meta">@GetMapping(&quot;/naver/callback&quot;)</span>   <span class="hljs-comment">// 네이버 콜백 처리</span>
    
    <span class="hljs-comment">// 3. 헬스체크 &amp; 메타데이터</span>
    <span class="hljs-meta">@GetMapping(&quot;/providers&quot;)</span>  <span class="hljs-comment">// 지원 플랫폼 목록</span>
    <span class="hljs-meta">@GetMapping(&quot;/health&quot;)</span>     <span class="hljs-comment">// 서비스 상태</span>
}
</code></pre>
<p><strong>의존성 주입</strong>:</p>
<pre><code class="language-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SocialAuthService socialAuthService;      <span class="hljs-comment">// 통합 로직 처리</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NaverAuthService naverAuthService;        <span class="hljs-comment">// 네이버 OAuth 전용</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SocialUserService socialUserService;     <span class="hljs-comment">// DB 사용자 관리</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JwtTokenProvider jwtTokenProvider;       <span class="hljs-comment">// JWT 토큰 생성</span>
</code></pre>
<h3 id="2-서비스-계층-구조">2. 서비스 계층 구조</h3>
<h4 id="21-통합-서비스-socialauthservice">2.1 통합 서비스 (SocialAuthService)</h4>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.service.social.SocialAuthService</code></p>
<p><strong>핵심 메서드</strong>:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SocialAuthService</span> {
    <span class="hljs-comment">// 각 플랫폼별 로그인 처리 (동일한 구조)</span>
    <span class="hljs-keyword">public</span> SocialLoginResponse <span class="hljs-title function_">googleLogin</span><span class="hljs-params">(GoogleLoginRequest request)</span>
    <span class="hljs-keyword">public</span> SocialLoginResponse <span class="hljs-title function_">kakaoLogin</span><span class="hljs-params">(KakaoLoginRequest request)</span>  
    <span class="hljs-keyword">public</span> SocialLoginResponse <span class="hljs-title function_">naverLogin</span><span class="hljs-params">(NaverLoginRequest request)</span>
    
    <span class="hljs-comment">// 소셜 회원가입 통합 처리</span>
    <span class="hljs-keyword">public</span> SocialSignUpResponse <span class="hljs-title function_">socialSignUp</span><span class="hljs-params">(SocialSignUpRequest request)</span>
}
</code></pre>
<p><strong>공통 처리 로직</strong>:</p>
<ol>
<li>소셜 플랫폼에서 사용자 정보 추출</li>
<li><code>SocialUserService.findOrCreateUserBySocial()</code> 호출</li>
<li>JWT 토큰 생성 및 Redis 캐싱</li>
<li>통일된 응답 구조 반환</li>
</ol>
<h4 id="22-google-인증-서비스-googleauthservice">2.2 Google 인증 서비스 (GoogleAuthService)</h4>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.service.social.GoogleAuthService</code></p>
<p><strong>특징</strong>:</p>
<ul>
<li><strong>토큰 타입</strong>: ID Token (JWT 형태)</li>
<li><strong>검증 방식</strong>: Google TokenInfo API 호출</li>
<li><strong>개발 모드</strong>: 더미 데이터 지원</li>
</ul>
<p><strong>핵심 메서드</strong>:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoogleAuthService</span> {
    <span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String idToken)</span> {
        <span class="hljs-comment">// 1. 개발모드 또는 더미토큰 체크</span>
        <span class="hljs-keyword">if</span> (devMode || isDummyToken(idToken)) {
            <span class="hljs-keyword">return</span> createDummyGoogleUserInfo(idToken);
        }
        
        <span class="hljs-comment">// 2. 실제 Google API 토큰 검증</span>
        Map&lt;String, Object&gt; tokenInfo = verifyGoogleIdToken(idToken);
        
        <span class="hljs-comment">// 3. 사용자 정보 추출 및 변환</span>
        <span class="hljs-keyword">return</span> extractUserInfoFromGoogle(tokenInfo);
    }
}
</code></pre>
<h4 id="23-카카오-인증-서비스-kakaoauthservice">2.3 카카오 인증 서비스 (KakaoAuthService)</h4>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.service.social.KakaoAuthService</code></p>
<p><strong>특징</strong>:</p>
<ul>
<li><strong>토큰 타입</strong>: Access Token</li>
<li><strong>검증 방식</strong>: 카카오 User Me API 호출</li>
<li><strong>헤더</strong>: <code>Authorization: Bearer {access_token}</code></li>
</ul>
<p><strong>핵심 메서드</strong>:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KakaoAuthService</span> {
    <span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String accessToken)</span> {
        <span class="hljs-comment">// 1. 개발모드 체크</span>
        <span class="hljs-keyword">if</span> (devMode) {
            <span class="hljs-keyword">return</span> createDevModeUserInfo();
        }
        
        <span class="hljs-comment">// 2. 카카오 User Info API 호출</span>
        Map&lt;String, Object&gt; userInfo = callKakaoUserInfoApi(accessToken);
        
        <span class="hljs-comment">// 3. 카카오 특유의 중첩 구조 파싱</span>
        <span class="hljs-keyword">return</span> parseKakaoUserInfo(userInfo);
    }
    
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">callKakaoUserInfoApi</span><span class="hljs-params">(String accessToken)</span> {
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span> + accessToken);
        headers.set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/x-www-form-urlencoded;charset=utf-8&quot;</span>);
        
        <span class="hljs-comment">// 카카오 API: https://kapi.kakao.com/v2/user/me</span>
        ResponseEntity&lt;Map&gt; response = restTemplate.exchange(kakaoUserInfoUrl, HttpMethod.GET, entity, Map.class);
    }
}
</code></pre>
<h4 id="24-네이버-인증-서비스-naverauthservice">2.4 네이버 인증 서비스 (NaverAuthService)</h4>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.service.social.NaverAuthService</code></p>
<p><strong>특징</strong>:</p>
<ul>
<li><strong>토큰 타입</strong>: Access Token</li>
<li><strong>OAuth 플로우</strong>: Authorization Code Grant (2단계)</li>
<li><strong>팝업 지원</strong>: 프론트엔드 팝업창 통신</li>
</ul>
<p><strong>핵심 메서드</strong>:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NaverAuthService</span> {
    <span class="hljs-comment">// 1. OAuth 인증 URL 생성</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">buildAuthorizationUrl</span><span class="hljs-params">(String redirectUri)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">return</span> UriComponentsBuilder.fromHttpUrl(naverAuthUrl)
                .queryParam(<span class="hljs-string">&quot;response_type&quot;</span>, <span class="hljs-string">&quot;code&quot;</span>)
                .queryParam(<span class="hljs-string">&quot;client_id&quot;</span>, naverClientId)
                .queryParam(<span class="hljs-string">&quot;redirect_uri&quot;</span>, naverRedirectUri)
                .queryParam(<span class="hljs-string">&quot;scope&quot;</span>, <span class="hljs-string">&quot;name email profile_image&quot;</span>)
                .queryParam(<span class="hljs-string">&quot;state&quot;</span>, state)
                .build().toUriString();
    }
    
    <span class="hljs-comment">// 2. Authorization Code → Access Token 교환</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAccessToken</span><span class="hljs-params">(String authorizationCode, String state)</span> {
        MultiValueMap&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedMultiValueMap</span>&lt;&gt;();
        params.add(<span class="hljs-string">&quot;grant_type&quot;</span>, <span class="hljs-string">&quot;authorization_code&quot;</span>);
        params.add(<span class="hljs-string">&quot;client_id&quot;</span>, naverClientId);
        params.add(<span class="hljs-string">&quot;client_secret&quot;</span>, naverClientSecret);
        params.add(<span class="hljs-string">&quot;redirect_uri&quot;</span>, naverRedirectUri);
        params.add(<span class="hljs-string">&quot;code&quot;</span>, authorizationCode);
        params.add(<span class="hljs-string">&quot;state&quot;</span>, state);
        
        <span class="hljs-comment">// 네이버 Token API: https://nid.naver.com/oauth2.0/token</span>
        ResponseEntity&lt;Map&gt; response = restTemplate.postForEntity(naverTokenUrl, params, Map.class);
    }
    
    <span class="hljs-comment">// 3. Access Token으로 사용자 정보 조회</span>
    <span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String accessToken)</span> {
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span> + accessToken);
        
        <span class="hljs-comment">// 네이버 User Info API: https://openapi.naver.com/v1/nid/me</span>
        ResponseEntity&lt;Map&gt; response = restTemplate.exchange(naverUserInfoUrl, HttpMethod.GET, entity, Map.class);
    }
}
</code></pre>
<h4 id="25-사용자-관리-서비스-socialuserservice">2.5 사용자 관리 서비스 (SocialUserService)</h4>
<p><strong>파일</strong>: <code>com.akc.b2c.authservice.service.SocialUserService</code></p>
<p><strong>3단계 자동 판단 로직</strong>:</p>
<pre><code class="language-java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> UserSocialResult <span class="hljs-title function_">findOrCreateUserBySocial</span><span class="hljs-params">(SocialUserInfo socialUserInfo)</span> {
    
    <span class="hljs-comment">// 1단계: 소셜 ID로 기존 계정 찾기 (Provider + Social ID)</span>
    Optional&lt;MemberSocialAccount&gt; existingSocialAccount = 
        memberSocialAccountRepository.findByProviderAndSocialId(provider, socialUserInfo.getSocialId());
    
    <span class="hljs-keyword">if</span> (existingSocialAccount.isPresent()) {
        <span class="hljs-comment">// 🟢 기존 소셜 계정 → 즉시 로그인</span>
        <span class="hljs-keyword">return</span> UserSocialResult.builder()
                .member(socialAccount.getMember())
                .isNewUser(<span class="hljs-literal">false</span>)
                .isNewSocialAccount(<span class="hljs-literal">false</span>)
                .build();
    }
    
    <span class="hljs-comment">// 2단계: 이메일로 기존 사용자 찾기</span>
    Optional&lt;Member&gt; existingMember = memberRepository.findActiveUserByEmail(socialUserInfo.getEmail());
    
    <span class="hljs-keyword">if</span> (existingMember.isPresent()) {
        <span class="hljs-comment">// 🔗 기존 사용자에게 소셜 계정 연결</span>
        <span class="hljs-type">Member</span> <span class="hljs-variable">member</span> <span class="hljs-operator">=</span> existingMember.get();
        <span class="hljs-type">MemberSocialAccount</span> <span class="hljs-variable">newSocialAccount</span> <span class="hljs-operator">=</span> createSocialAccount(member, socialUserInfo, provider);
        member.addSocialAccount(newSocialAccount);
        
        <span class="hljs-keyword">return</span> UserSocialResult.builder()
                .member(member)
                .isNewUser(<span class="hljs-literal">false</span>)
                .isNewSocialAccount(<span class="hljs-literal">true</span>)
                .build();
    }
    
    <span class="hljs-comment">// 3단계: 완전히 새로운 사용자 생성</span>
    <span class="hljs-type">Member</span> <span class="hljs-variable">newMember</span> <span class="hljs-operator">=</span> createMember(socialUserInfo);
    <span class="hljs-type">Member</span> <span class="hljs-variable">savedMember</span> <span class="hljs-operator">=</span> memberRepository.save(newMember);
    <span class="hljs-type">MemberSocialAccount</span> <span class="hljs-variable">newSocialAccount</span> <span class="hljs-operator">=</span> createSocialAccount(savedMember, socialUserInfo, provider);
    
    <span class="hljs-keyword">return</span> UserSocialResult.builder()
            .member(newMember)
            .isNewUser(<span class="hljs-literal">true</span>)
            .isNewSocialAccount(<span class="hljs-literal">true</span>)
            .build();
}
</code></pre>
<hr>
<h2 id="️-프론트엔드-구현-가이드">🖥️ 프론트엔드 구현 가이드</h2>
<h3 id="1-프로젝트-설정-및-환경-구성">1. 프로젝트 설정 및 환경 구성</h3>
<h4 id="11-패키지-설치-reactnextjs">1.1 패키지 설치 (React/Next.js)</h4>
<pre><code class="language-bash"><span class="hljs-comment"># TypeScript를 사용하는 경우</span>
npm install --save-dev @types/google.accounts

<span class="hljs-comment"># 상태 관리 (선택사항)</span>
npm install zustand  <span class="hljs-comment"># 또는 redux-toolkit</span>
</code></pre>
<h4 id="12-환경-변수-설정">1.2 환경 변수 설정</h4>
<pre><code class="language-env"># .env.local (Next.js) 또는 .env (React)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com
NEXT_PUBLIC_KAKAO_JAVASCRIPT_KEY=YOUR_KAKAO_JAVASCRIPT_KEY
NEXT_PUBLIC_AUTH_SERVICE_URL=http://localhost:8082
NEXT_PUBLIC_ENVIRONMENT=development  # development | production
</code></pre>
<h4 id="13-typescript-타입-정의">1.3 TypeScript 타입 정의</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// types/social-login.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SocialLoginRequest</span> {
  idToken?: <span class="hljs-built_in">string</span>;
  accessToken?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">deviceInfo</span>: {
    <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span> | <span class="hljs-string">&#x27;MOBILE_APP&#x27;</span> | <span class="hljs-string">&#x27;ADMIN_WEB&#x27;</span>;
    <span class="hljs-attr">deviceId</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">appVersion</span>: <span class="hljs-built_in">string</span>;
  };
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SocialLoginResponse</span> {
  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;
  accessToken?: <span class="hljs-built_in">string</span>;
  refreshToken?: <span class="hljs-built_in">string</span>;
  tokenType?: <span class="hljs-built_in">string</span>;
  expiresIn?: <span class="hljs-built_in">number</span>;
  userInfo?: <span class="hljs-title class_">UserInfo</span>;
  needsAdditionalInfo?: <span class="hljs-built_in">boolean</span>;
  needsUsernameInput?: <span class="hljs-built_in">boolean</span>;
  needsAccountLink?: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  error?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserInfo</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  profileImageUrl?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">isNewUser</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-comment">// Global type definitions for Google GSI</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
    <span class="hljs-attr">google</span>: {
      <span class="hljs-attr">accounts</span>: {
        <span class="hljs-attr">id</span>: {
          <span class="hljs-attr">initialize</span>: <span class="hljs-function">(<span class="hljs-params">config: GoogleConfig</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
          <span class="hljs-attr">prompt</span>: <span class="hljs-function">(<span class="hljs-params">callback?: (notification: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
          <span class="hljs-attr">renderButton</span>: <span class="hljs-function">(<span class="hljs-params">element: HTMLElement, config: GoogleButtonConfig</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
          <span class="hljs-attr">disableAutoSelect</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
          <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
        };
      };
    };
    <span class="hljs-title class_">Kakao</span>: {
      <span class="hljs-attr">init</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
      <span class="hljs-attr">isInitialized</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">boolean</span>;
      <span class="hljs-title class_">Auth</span>: {
        <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">config: KakaoLoginConfig</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
        <span class="hljs-attr">logout</span>: <span class="hljs-function">(<span class="hljs-params">callback?: () =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
        <span class="hljs-attr">getAccessToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>;
      };
    };
  }
}
</code></pre>
<h3 id="2-html-구조-및-sdk-설정">2. HTML 구조 및 SDK 설정</h3>
<h4 id="21-nextjs-script-컴포넌트-활용">2.1 Next.js Script 컴포넌트 활용</h4>
<pre><code class="language-tsx"><span class="hljs-comment">// components/SocialLoginProvider.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Script</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next/script&#x27;</span>;
<span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">SocialLoginProvider</span> = (<span class="hljs-params">{ children }: { children: React.ReactNode }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [isGoogleLoaded, setIsGoogleLoaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [isKakaoLoaded, setIsKakaoLoaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* Google GSI SDK */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Script</span>
        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://accounts.google.com/gsi/client&quot;</span>
        <span class="hljs-attr">strategy</span>=<span class="hljs-string">&quot;afterInteractive&quot;</span>
        <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{()</span> =&gt;</span><span class="language-javascript"> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Google GSI SDK 로드 완료&#x27;</span>);
          <span class="hljs-title function_">setIsGoogleLoaded</span>(<span class="hljs-literal">true</span>);
        }}
        onError={<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Google GSI SDK 로드 실패&#x27;</span>);
        }}
      /&gt;

      {<span class="hljs-comment">/* Kakao JavaScript SDK */</span>}
      &lt;<span class="hljs-title class_">Script</span>
        src=<span class="hljs-string">&quot;https://t1.kakaocdn.net/kakao_js_sdk/2.7.5/kakao.min.js&quot;</span>
        strategy=<span class="hljs-string">&quot;afterInteractive&quot;</span>
        onLoad={<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Kakao SDK 로드 완료&#x27;</span>);
          <span class="hljs-title function_">setIsKakaoLoaded</span>(<span class="hljs-literal">true</span>);
          <span class="hljs-comment">// Kakao SDK 초기화</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span> &amp;&amp; !<span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>.<span class="hljs-title function_">isInitialized</span>()) {
            <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>.<span class="hljs-title function_">init</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_KAKAO_JAVASCRIPT_KEY</span>);
          }
        }}
        onError={<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Kakao SDK 로드 실패&#x27;</span>);
        }}
      /&gt;

      {children}
    &lt;/&gt;</span></span>
  );
};
</code></pre>
<h4 id="22-sdk-로딩-상태-관리">2.2 SDK 로딩 상태 관리</h4>
<pre><code class="language-tsx"><span class="hljs-comment">// hooks/useSocialSDK.ts</span>
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useSocialSDK</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [sdkStatus, setSdkStatus] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">google</span>: { <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">initialized</span>: <span class="hljs-literal">false</span> },
    <span class="hljs-attr">kakao</span>: { <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">initialized</span>: <span class="hljs-literal">false</span> }
  });

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// Google SDK 상태 체크</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkGoogleSDK</span> = (<span class="hljs-params"></span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span>?.<span class="hljs-property">id</span>) {
        <span class="hljs-title function_">setSdkStatus</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({
          ...prev,
          <span class="hljs-attr">google</span>: { <span class="hljs-attr">loaded</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">initialized</span>: <span class="hljs-literal">true</span> }
        }));
      }
    };

    <span class="hljs-comment">// Kakao SDK 상태 체크  </span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkKakaoSDK</span> = (<span class="hljs-params"></span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-title function_">isInitialized</span>()) {
        <span class="hljs-title function_">setSdkStatus</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({
          ...prev,
          <span class="hljs-attr">kakao</span>: { <span class="hljs-attr">loaded</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">initialized</span>: <span class="hljs-literal">true</span> }
        }));
      }
    };

    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">checkGoogleSDK</span>();
      <span class="hljs-title function_">checkKakaoSDK</span>();
    }, <span class="hljs-number">100</span>);

    <span class="hljs-comment">// 5초 후 체크 중단</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval), <span class="hljs-number">5000</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
  }, []);

  <span class="hljs-keyword">return</span> sdkStatus;
};
</code></pre>
<h3 id="3-플랫폼별-프론트엔드-구현">3. 플랫폼별 프론트엔드 구현</h3>
<h4 id="31-google-로그인-id-token-방식">3.1 Google 로그인 (ID Token 방식)</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// hooks/useGoogleLogin.ts</span>
<span class="hljs-keyword">import</span> { useCallback, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SocialLoginResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types/social-login&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useGoogleLogin</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// Google GSI 초기화</span>
  <span class="hljs-keyword">const</span> initializeGoogleLogin = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span>?.<span class="hljs-property">id</span>) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;Google SDK가 로드되지 않았습니다.&#x27;</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>.<span class="hljs-property">accounts</span>.<span class="hljs-property">id</span>.<span class="hljs-title function_">initialize</span>({
        <span class="hljs-attr">client_id</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_GOOGLE_CLIENT_ID</span>!,
        <span class="hljs-attr">callback</span>: handleCredentialResponse,
        <span class="hljs-attr">auto_select</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">cancel_on_tap_outside</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">use_fedcm_for_prompt</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// FedCM 비활성화로 팝업 보장</span>
      });

      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;Google 초기화 실패&#x27;</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Google 초기화 오류:&#x27;</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }, []);

  <span class="hljs-comment">// Google 콜백 처리</span>
  <span class="hljs-keyword">const</span> handleCredentialResponse = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">response</span>: <span class="hljs-built_in">any</span>) =&gt; {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> deviceId = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;deviceId&#x27;</span>) || <span class="hljs-title function_">generateDeviceId</span>();
      
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_AUTH_SERVICE_URL}</span>/api/auth/social/google`</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { 
          <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
          <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
        },
        <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>, <span class="hljs-comment">// CORS 쿠키 허용</span>
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
          <span class="hljs-attr">idToken</span>: response.<span class="hljs-property">credential</span>,
          <span class="hljs-attr">deviceInfo</span>: {
            <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span>,
            <span class="hljs-attr">deviceId</span>: deviceId,
            <span class="hljs-attr">appVersion</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_APP_VERSION</span> || <span class="hljs-string">&#x27;1.0.0&#x27;</span>
          }
        })
      });

      <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${result.status}</span>: <span class="hljs-subst">${result.statusText}</span>`</span>);
      }

      <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">SocialLoginResponse</span> = <span class="hljs-keyword">await</span> result.<span class="hljs-title function_">json</span>();
      
      <span class="hljs-keyword">if</span> (data.<span class="hljs-property">success</span>) {
        <span class="hljs-title function_">handleSocialLoginSuccess</span>(data, <span class="hljs-string">&#x27;Google&#x27;</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span> || <span class="hljs-string">&#x27;Google 로그인 실패&#x27;</span>);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&#x27;알 수 없는 오류&#x27;</span>;
      <span class="hljs-title function_">setError</span>(errorMessage);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Google 로그인 오류:&#x27;</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  }, []);

  <span class="hljs-comment">// 로그인 버튼 렌더링</span>
  <span class="hljs-keyword">const</span> renderGoogleButton = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">elementId: <span class="hljs-built_in">string</span>, config?: Partial&lt;GoogleButtonConfig&gt;</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(elementId);
    <span class="hljs-keyword">if</span> (!element || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span>?.<span class="hljs-property">id</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> defaultConfig = {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">&#x27;outline&#x27;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">&#x27;large&#x27;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;standard&#x27;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
      <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;signin_with&#x27;</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
      <span class="hljs-attr">locale</span>: <span class="hljs-string">&#x27;ko&#x27;</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>.<span class="hljs-property">accounts</span>.<span class="hljs-property">id</span>.<span class="hljs-title function_">renderButton</span>(element, { ...defaultConfig, ...config });
  }, []);

  <span class="hljs-keyword">return</span> {
    isLoading,
    error,
    initializeGoogleLogin,
    renderGoogleButton
  };
};

<span class="hljs-comment">// 유틸리티 함수</span>
<span class="hljs-keyword">const</span> generateDeviceId = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> id = <span class="hljs-string">`web-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).substr(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>)}</span>`</span>;
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;deviceId&#x27;</span>, id);
  <span class="hljs-keyword">return</span> id;
};
</code></pre>
<h4 id="32-카카오-로그인-access-token-방식">3.2 카카오 로그인 (Access Token 방식)</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// hooks/useKakaoLogin.ts</span>
<span class="hljs-keyword">import</span> { useCallback, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useKakaoLogin</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 카카오 로그인 실행</span>
  <span class="hljs-keyword">const</span> loginWithKakao = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-property">Auth</span>) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;카카오 SDK가 로드되지 않았습니다.&#x27;</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 카카오 로그인 팝업</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>.<span class="hljs-property">Auth</span>.<span class="hljs-title function_">login</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">kakaoResponse</span>: <span class="hljs-built_in">any</span>) =&gt; {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> deviceId = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;deviceId&#x27;</span>) || <span class="hljs-title function_">generateDeviceId</span>();
            
            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_AUTH_SERVICE_URL}</span>/api/auth/social/kakao`</span>, {
              <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
              <span class="hljs-attr">headers</span>: { 
                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
                <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
              },
              <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>,
              <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                <span class="hljs-attr">accessToken</span>: kakaoResponse.<span class="hljs-property">access_token</span>,
                <span class="hljs-attr">deviceInfo</span>: {
                  <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span>,
                  <span class="hljs-attr">deviceId</span>: deviceId,
                  <span class="hljs-attr">appVersion</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_APP_VERSION</span> || <span class="hljs-string">&#x27;1.0.0&#x27;</span>
                }
              })
            });

            <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">ok</span>) {
              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${result.status}</span>: <span class="hljs-subst">${result.statusText}</span>`</span>);
            }

            <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">SocialLoginResponse</span> = <span class="hljs-keyword">await</span> result.<span class="hljs-title function_">json</span>();
            
            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">success</span>) {
              <span class="hljs-title function_">handleSocialLoginSuccess</span>(data, <span class="hljs-string">&#x27;Kakao&#x27;</span>);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span> || <span class="hljs-string">&#x27;카카오 로그인 실패&#x27;</span>);
            }
          } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&#x27;알 수 없는 오류&#x27;</span>;
            <span class="hljs-title function_">setError</span>(errorMessage);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;카카오 백엔드 통신 오류:&#x27;</span>, error);
          } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          }
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">kakaoError: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;카카오 인증 실패&#x27;</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;카카오 로그인 실패:&#x27;</span>, kakaoError);
        }
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;카카오 로그인 초기화 실패&#x27;</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;카카오 로그인 오류:&#x27;</span>, error);
    }
  }, []);

  <span class="hljs-keyword">return</span> {
    isLoading,
    error,
    loginWithKakao
  };
};
</code></pre>
<h4 id="33-네이버-로그인-팝업-방식">3.3 네이버 로그인 (팝업 방식)</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// hooks/useNaverLogin.ts</span>
<span class="hljs-keyword">import</span> { useCallback, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useNaverLogin</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 네이버 로그인 팝업 실행</span>
  <span class="hljs-keyword">const</span> loginWithNaver = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> popup = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(
        <span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_AUTH_SERVICE_URL}</span>/api/auth/social/naver/login`</span>,
        <span class="hljs-string">&#x27;naverLogin&#x27;</span>,
        <span class="hljs-string">&#x27;width=500,height=600,scrollbars=yes,resizable=yes,top=50,left=50&#x27;</span>
      );

      <span class="hljs-keyword">if</span> (!popup) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;팝업이 차단되었습니다. 브라우저의 팝업 설정을 확인해주세요.&#x27;</span>);
      }

      <span class="hljs-comment">// 팝업 창 닫힘 감지</span>
      <span class="hljs-keyword">const</span> popupTimer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (popup.<span class="hljs-property">closed</span>) {
          <span class="hljs-built_in">clearInterval</span>(popupTimer);
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
        }
      }, <span class="hljs-number">1000</span>);

      <span class="hljs-comment">// 30초 후 자동 정리</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (!popup.<span class="hljs-property">closed</span>) {
          popup.<span class="hljs-title function_">close</span>();
          <span class="hljs-built_in">clearInterval</span>(popupTimer);
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          <span class="hljs-title function_">setError</span>(<span class="hljs-string">&#x27;로그인 시간이 초과되었습니다.&#x27;</span>);
        }
      }, <span class="hljs-number">30000</span>);

    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&#x27;알 수 없는 오류&#x27;</span>;
      <span class="hljs-title function_">setError</span>(errorMessage);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;네이버 로그인 오류:&#x27;</span>, error);
    }
  }, []);

  <span class="hljs-comment">// 팝업 메시지 리스너 설정</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePopupMessage</span> = (<span class="hljs-params">event: MessageEvent</span>) =&gt; {
      <span class="hljs-comment">// 보안: AuthService 도메인만 허용</span>
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">origin</span> !== process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_AUTH_SERVICE_URL</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;허용되지 않은 도메인에서 메시지:&#x27;</span>, event.<span class="hljs-property">origin</span>);
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">const</span> { <span class="hljs-keyword">type</span>, result, error } = event.<span class="hljs-property">data</span>;

      <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">type</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;NAVER_LOGIN_SUCCESS&#x27;</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;네이버 로그인 성공:&#x27;</span>, result);
          <span class="hljs-title function_">handleSocialLoginSuccess</span>(result, <span class="hljs-string">&#x27;Naver&#x27;</span>);
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;NAVER_SIGNUP_NEEDED&#x27;</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;네이버 회원가입 필요:&#x27;</span>, result);
          <span class="hljs-title function_">handleNaverSignupNeeded</span>(result);
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;NAVER_LOGIN_ERROR&#x27;</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;네이버 로그인 오류:&#x27;</span>, error);
          <span class="hljs-title function_">setError</span>(error?.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;네이버 로그인 중 오류가 발생했습니다.&#x27;</span>);
          <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
          <span class="hljs-keyword">break</span>;

        <span class="hljs-attr">default</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;알 수 없는 메시지 타입:&#x27;</span>, <span class="hljs-keyword">type</span>);
      }
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, handlePopupMessage);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, handlePopupMessage);
  }, []);

  <span class="hljs-keyword">return</span> {
    isLoading,
    error,
    loginWithNaver
  };
};

<span class="hljs-comment">// 네이버 회원가입 필요 처리</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNaverSignupNeeded</span> = (<span class="hljs-params">result: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> { needsUsernameInput, needsAdditionalInfo, tempUserInfo } = result;
  
  <span class="hljs-comment">// 회원가입 모달 표시 또는 페이지 이동</span>
  <span class="hljs-comment">// 상태 관리 라이브러리를 통해 전역 상태 업데이트</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;추가 정보 입력 필요:&#x27;</span>, {
    needsUsernameInput,
    needsAdditionalInfo,
    tempUserInfo
  });
};
</code></pre>
<h3 id="4-통합-응답-처리-및-사용자-경험ux-최적화">4. 통합 응답 처리 및 사용자 경험(UX) 최적화</h3>
<h4 id="41-로딩-상태-관리">4.1 로딩 상태 관리</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// components/SocialLoginButton.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Loader</span>, <span class="hljs-title class_">CheckCircle</span>, <span class="hljs-title class_">AlertCircle</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lucide-react&#x27;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SocialLoginButtonProps</span> {
  <span class="hljs-attr">provider</span>: <span class="hljs-string">&#x27;google&#x27;</span> | <span class="hljs-string">&#x27;kakao&#x27;</span> | <span class="hljs-string">&#x27;naver&#x27;</span>;
  <span class="hljs-attr">onLogin</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  disabled?: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SocialLoginButton</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SocialLoginButtonProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  provider,
  onLogin,
  disabled = <span class="hljs-literal">false</span>
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [status, setStatus] = useState&lt;<span class="hljs-string">&#x27;idle&#x27;</span> | <span class="hljs-string">&#x27;loading&#x27;</span> | <span class="hljs-string">&#x27;success&#x27;</span> | <span class="hljs-string">&#x27;error&#x27;</span>&gt;(<span class="hljs-string">&#x27;idle&#x27;</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">if</span> (isLoading || disabled) <span class="hljs-keyword">return</span>;

    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;loading&#x27;</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">onLogin</span>();
      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;success&#x27;</span>);
      
      <span class="hljs-comment">// 성공 상태를 잠시 보여준 후 초기화</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;idle&#x27;</span>);
        <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
      }, <span class="hljs-number">2000</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;error&#x27;</span>);
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;idle&#x27;</span>);
        <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
      }, <span class="hljs-number">3000</span>);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getButtonContent</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">switch</span> (status) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;loading&#x27;</span>:
        <span class="hljs-keyword">return</span> (
          <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Loader</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;w-4 h-4 animate-spin&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{provider.toUpperCase()} 로그인 중...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
        );
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;success&#x27;</span>:
        <span class="hljs-keyword">return</span> (
          <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">CheckCircle</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;w-4 h-4 text-green-500&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>로그인 성공!<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
        );
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;error&#x27;</span>:
        <span class="hljs-keyword">return</span> (
          <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">AlertCircle</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;w-4 h-4 text-red-500&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>다시 시도해주세요<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
        );
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> (
          <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">icons</span>/${<span class="hljs-attr">provider</span>}<span class="hljs-attr">.svg</span>`} <span class="hljs-attr">alt</span>=<span class="hljs-string">{provider}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;w-4 h-4&quot;</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{provider.toUpperCase()}로 시작하기<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>
      <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isLoading</span> || <span class="hljs-attr">disabled</span>}
      <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`
        <span class="hljs-attr">flex</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">gap-3</span> <span class="hljs-attr">w-full</span> <span class="hljs-attr">px-4</span> <span class="hljs-attr">py-3</span> <span class="hljs-attr">rounded-lg</span> <span class="hljs-attr">border</span>
        <span class="hljs-attr">transition-all</span> <span class="hljs-attr">duration-200</span> <span class="hljs-attr">font-medium</span>
        ${<span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;error&#x27;</span> ? &#x27;<span class="hljs-attr">border-red-300</span> <span class="hljs-attr">bg-red-50</span> <span class="hljs-attr">text-red-700</span>&#x27; <span class="hljs-attr">:</span>
          <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;success&#x27;</span> ? &#x27;<span class="hljs-attr">border-green-300</span> <span class="hljs-attr">bg-green-50</span> <span class="hljs-attr">text-green-700</span>&#x27; <span class="hljs-attr">:</span>
          &#x27;<span class="hljs-attr">border-gray-300</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">text-gray-700</span> <span class="hljs-attr">hover:bg-gray-50</span>&#x27;}
        ${(<span class="hljs-attr">isLoading</span> || <span class="hljs-attr">disabled</span>) &amp;&amp; &#x27;<span class="hljs-attr">cursor-not-allowed</span> <span class="hljs-attr">opacity-60</span>&#x27;}
      `}
    &gt;</span>
      {getButtonContent()}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
};
</code></pre>
<h4 id="42-에러-처리-및-사용자-피드백">4.2 에러 처리 및 사용자 피드백</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// hooks/useErrorHandler.ts</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ErrorInfo</span> {
  code?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  provider?: <span class="hljs-built_in">string</span>;
  retry?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useErrorHandler</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">ErrorInfo</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSocialLoginError</span> = (<span class="hljs-params">error: <span class="hljs-built_in">any</span>, provider: <span class="hljs-built_in">string</span>, retryFn?: () =&gt; <span class="hljs-built_in">void</span></span>) =&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">errorInfo</span>: <span class="hljs-title class_">ErrorInfo</span>;

    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;팝업이 차단&#x27;</span>)) {
      errorInfo = {
        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;POPUP_BLOCKED&#x27;</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;팝업이 차단되었습니다. 브라우저 설정을 확인하고 다시 시도해주세요.&#x27;</span>,
        provider,
        <span class="hljs-attr">retry</span>: retryFn
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;HTTP 403&#x27;</span>)) {
      errorInfo = {
        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;FORBIDDEN&#x27;</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;로그인 권한이 없습니다. 관리자에게 문의해주세요.&#x27;</span>,
        provider
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;HTTP 500&#x27;</span>)) {
      errorInfo = {
        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;SERVER_ERROR&#x27;</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.&#x27;</span>,
        provider,
        <span class="hljs-attr">retry</span>: retryFn
      };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;Network&#x27;</span>)) {
      errorInfo = {
        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;NETWORK_ERROR&#x27;</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;네트워크 연결을 확인해주세요.&#x27;</span>,
        provider,
        <span class="hljs-attr">retry</span>: retryFn
      };
    } <span class="hljs-keyword">else</span> {
      errorInfo = {
        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;UNKNOWN&#x27;</span>,
        <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;알 수 없는 오류가 발생했습니다.&#x27;</span>,
        provider,
        <span class="hljs-attr">retry</span>: retryFn
      };
    }

    <span class="hljs-title function_">setError</span>(errorInfo);
    
    <span class="hljs-comment">// 에러 로깅 (선택사항)</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 소셜 로그인 오류:`</span>, error);
    
    <span class="hljs-comment">// 에러 분석을 위한 로그 전송 (선택사항)</span>
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>) {
      <span class="hljs-comment">// sendErrorLog(errorInfo);</span>
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearError</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">return</span> {
    error,
    handleSocialLoginError,
    clearError
  };
};
</code></pre>
<h4 id="43-통합-소셜-로그인-응답-처리">4.3 통합 소셜 로그인 응답 처리</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/socialLoginHandler.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SocialLoginResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types/social-login&#x27;</span>;

<span class="hljs-comment">// 토큰 저장 및 관리</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSocialLoginSuccess</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">
  response: SocialLoginResponse, 
  provider: <span class="hljs-built_in">string</span>
</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// JWT 토큰 저장 (httpOnly 쿠키 권장, 여기서는 localStorage 예시)</span>
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">accessToken</span>) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;accessToken&#x27;</span>, response.<span class="hljs-property">accessToken</span>);
    }
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">refreshToken</span>) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;refreshToken&#x27;</span>, response.<span class="hljs-property">refreshToken</span>);
    }

    <span class="hljs-comment">// 사용자 정보 저장</span>
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">userInfo</span>) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;userInfo&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">userInfo</span>));
    }

    <span class="hljs-comment">// 추가 정보 입력이 필요한 경우</span>
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">needsAdditionalInfo</span> || response.<span class="hljs-property">needsUsernameInput</span>) {
      <span class="hljs-comment">// 회원가입 폼으로 이동하거나 모달 표시</span>
      <span class="hljs-title function_">showSignUpModal</span>(provider, response);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 로그인 성공 알림</span>
    <span class="hljs-title function_">showSuccessNotification</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인이 완료되었습니다!`</span>);

    <span class="hljs-comment">// 홈 페이지로 이동 또는 이전 페이지로 복귀</span>
    <span class="hljs-keyword">const</span> returnUrl = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;returnUrl&#x27;</span>) || <span class="hljs-string">&#x27;/dashboard&#x27;</span>;
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = returnUrl;

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;로그인 성공 처리 중 오류:&#x27;</span>, error);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;로그인 처리 중 오류가 발생했습니다.&#x27;</span>);
  }
};

<span class="hljs-comment">// 회원가입 모달 표시</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">showSignUpModal</span> = (<span class="hljs-params">provider: <span class="hljs-built_in">string</span>, response: SocialLoginResponse</span>) =&gt; {
  <span class="hljs-comment">// 상태 관리 라이브러리를 사용하여 모달 상태 업데이트</span>
  <span class="hljs-comment">// 예: Zustand, Redux Toolkit 등</span>
  
  <span class="hljs-keyword">const</span> signUpData = {
    provider,
    <span class="hljs-attr">socialToken</span>: response.<span class="hljs-property">accessToken</span>, <span class="hljs-comment">// 또는 임시 토큰</span>
    <span class="hljs-attr">userInfo</span>: response.<span class="hljs-property">userInfo</span>,
    <span class="hljs-attr">requirements</span>: {
      <span class="hljs-attr">needsUsernameInput</span>: response.<span class="hljs-property">needsUsernameInput</span>,
      <span class="hljs-attr">needsAdditionalInfo</span>: response.<span class="hljs-property">needsAdditionalInfo</span>,
      <span class="hljs-attr">needsAccountLink</span>: response.<span class="hljs-property">needsAccountLink</span>
    }
  };

  <span class="hljs-comment">// 전역 상태 업데이트</span>
  <span class="hljs-comment">// useSignUpStore.getState().setSignUpData(signUpData);</span>
  <span class="hljs-comment">// useUIStore.getState().setModalOpen(&#x27;signup&#x27;);</span>
};

<span class="hljs-comment">// 성공 알림 표시</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">showSuccessNotification</span> = (<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 토스트 알림 라이브러리 사용 (예: react-hot-toast, sonner 등)</span>
  <span class="hljs-comment">// toast.success(message);</span>
  
  <span class="hljs-comment">// 또는 브라우저 기본 알림</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;Notification&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span> &amp;&amp; <span class="hljs-title class_">Notification</span>.<span class="hljs-property">permission</span> === <span class="hljs-string">&#x27;granted&#x27;</span>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(<span class="hljs-string">&#x27;로그인 성공&#x27;</span>, { <span class="hljs-attr">body</span>: message });
  }
};
</code></pre>
<h4 id="44-회원가입-폼-컴포넌트">4.4 회원가입 폼 컴포넌트</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// components/SocialSignUpForm.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { useForm } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-hook-form&#x27;</span>;
<span class="hljs-keyword">import</span> { zodResolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@hookform/resolvers/zod&#x27;</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zod&#x27;</span>;

<span class="hljs-keyword">const</span> signUpSchema = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">userId</span>: z.<span class="hljs-title function_">string</span>()
    .<span class="hljs-title function_">min</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;아이디는 4자 이상이어야 합니다.&#x27;</span>)
    .<span class="hljs-title function_">max</span>(<span class="hljs-number">20</span>, <span class="hljs-string">&#x27;아이디는 20자 이하여야 합니다.&#x27;</span>)
    .<span class="hljs-title function_">regex</span>(<span class="hljs-regexp">/^[a-zA-Z0-9_]+$/</span>, <span class="hljs-string">&#x27;아이디는 영문, 숫자, 밑줄만 사용 가능합니다.&#x27;</span>),
  <span class="hljs-attr">phone</span>: z.<span class="hljs-title function_">string</span>()
    .<span class="hljs-title function_">regex</span>(<span class="hljs-regexp">/^010-\d{4}-\d{4}$/</span>, <span class="hljs-string">&#x27;휴대폰 번호 형식이 올바르지 않습니다.&#x27;</span>),
  <span class="hljs-attr">termsAgreed</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">refine</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> val, <span class="hljs-string">&#x27;이용약관에 동의해주세요.&#x27;</span>),
  <span class="hljs-attr">privacyAgreed</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">refine</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> val, <span class="hljs-string">&#x27;개인정보 처리방침에 동의해주세요.&#x27;</span>),
  <span class="hljs-attr">marketingAgreed</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">optional</span>()
});

<span class="hljs-keyword">type</span> <span class="hljs-title class_">SignUpFormData</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> signUpSchema&gt;;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SocialSignUpFormProps</span> {
  <span class="hljs-attr">provider</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">socialToken</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">userInfo</span>: <span class="hljs-built_in">any</span>;
  <span class="hljs-attr">requirements</span>: {
    <span class="hljs-attr">needsUsernameInput</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">needsAdditionalInfo</span>: <span class="hljs-built_in">boolean</span>;
  };
  <span class="hljs-attr">onSubmit</span>: <span class="hljs-function">(<span class="hljs-params">data: SignUpFormData</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-attr">onCancel</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SocialSignUpForm</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SocialSignUpFormProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  provider,
  userInfo,
  requirements,
  onSubmit,
  onCancel
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [isSubmitting, setIsSubmitting] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [userIdAvailable, setUserIdAvailable] = useState&lt;<span class="hljs-built_in">boolean</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> { register, handleSubmit, watch, <span class="hljs-attr">formState</span>: { errors } } = useForm&lt;<span class="hljs-title class_">SignUpFormData</span>&gt;({
    <span class="hljs-attr">resolver</span>: <span class="hljs-title function_">zodResolver</span>(signUpSchema),
    <span class="hljs-attr">defaultValues</span>: {
      <span class="hljs-attr">marketingAgreed</span>: <span class="hljs-literal">false</span>
    }
  });

  <span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">watch</span>(<span class="hljs-string">&#x27;userId&#x27;</span>);

  <span class="hljs-comment">// 아이디 중복 확인</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkUserIdAvailability</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!userId || userId.<span class="hljs-property">length</span> &lt; <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${process.env.NEXT_PUBLIC_AUTH_SERVICE_URL}</span>/api/auth/check-userid`</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ userId })
      });

      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
      <span class="hljs-title function_">setUserIdAvailable</span>(data.<span class="hljs-property">available</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;아이디 중복 확인 오류:&#x27;</span>, error);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFormSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">data: SignUpFormData</span>) =&gt; {
    <span class="hljs-title function_">setIsSubmitting</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">onSubmit</span>(data);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;회원가입 오류:&#x27;</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsSubmitting</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;bg-white p-6 rounded-lg max-w-md w-full mx-4&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-xl font-bold mb-4&quot;</span>&gt;</span>
          {provider.toUpperCase()} 회원가입
        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit(handleFormSubmit)}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;space-y-4&quot;</span>&gt;</span>
          {/* 기본 정보 표시 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;p-3 bg-gray-50 rounded&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-gray-600&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>이메일:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {userInfo.email}
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-gray-600&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>이름:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {userInfo.name}
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 아이디 입력 (필요한 경우) */}
          {requirements.needsUsernameInput &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span>&gt;</span>
                아이디
              <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;relative&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                  {<span class="hljs-attr">...register</span>(&#x27;<span class="hljs-attr">userId</span>&#x27;)}
                  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">w-full</span> <span class="hljs-attr">px-3</span> <span class="hljs-attr">py-2</span> <span class="hljs-attr">border</span> <span class="hljs-attr">rounded-md</span> ${
                    <span class="hljs-attr">errors.userId</span> ? &#x27;<span class="hljs-attr">border-red-300</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">border-gray-300</span>&#x27;
                  }`}
                  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;아이디를 입력하세요&quot;</span>
                  <span class="hljs-attr">onBlur</span>=<span class="hljs-string">{()</span> =&gt;</span> checkUserIdAvailability(userId)}
                /&gt;
                {userIdAvailable === false &amp;&amp; (
                  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-red-600 mt-1&quot;</span>&gt;</span>이미 사용 중인 아이디입니다.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                )}
                {userIdAvailable === true &amp;&amp; (
                  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-green-600 mt-1&quot;</span>&gt;</span>사용 가능한 아이디입니다.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                )}
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              {errors.userId &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-red-600 mt-1&quot;</span>&gt;</span>{errors.userId.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* 휴대폰 번호 (필요한 경우) */}
          {requirements.needsAdditionalInfo &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;block text-sm font-medium text-gray-700 mb-1&quot;</span>&gt;</span>
                휴대폰 번호
              <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                {<span class="hljs-attr">...register</span>(&#x27;<span class="hljs-attr">phone</span>&#x27;)}
                <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;tel&quot;</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">w-full</span> <span class="hljs-attr">px-3</span> <span class="hljs-attr">py-2</span> <span class="hljs-attr">border</span> <span class="hljs-attr">rounded-md</span> ${
                  <span class="hljs-attr">errors.phone</span> ? &#x27;<span class="hljs-attr">border-red-300</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">border-gray-300</span>&#x27;
                }`}
                <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;010-0000-0000&quot;</span>
              /&gt;</span>
              {errors.phone &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-red-600 mt-1&quot;</span>&gt;</span>{errors.phone.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* 약관 동의 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;space-y-2&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex items-center&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                {<span class="hljs-attr">...register</span>(&#x27;<span class="hljs-attr">termsAgreed</span>&#x27;)}
                <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;mr-2&quot;</span>
              /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm&quot;</span>&gt;</span>이용약관에 동의합니다 (필수)<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            {errors.termsAgreed &amp;&amp; (
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-red-600&quot;</span>&gt;</span>{errors.termsAgreed.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            )}

            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex items-center&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                {<span class="hljs-attr">...register</span>(&#x27;<span class="hljs-attr">privacyAgreed</span>&#x27;)}
                <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;mr-2&quot;</span>
              /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm&quot;</span>&gt;</span>개인정보 처리방침에 동의합니다 (필수)<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            {errors.privacyAgreed &amp;&amp; (
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm text-red-600&quot;</span>&gt;</span>{errors.privacyAgreed.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            )}

            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex items-center&quot;</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                {<span class="hljs-attr">...register</span>(&#x27;<span class="hljs-attr">marketingAgreed</span>&#x27;)}
                <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;mr-2&quot;</span>
              /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-sm&quot;</span>&gt;</span>마케팅 정보 수신에 동의합니다 (선택)<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 버튼 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex gap-2 pt-4&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onCancel}</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50&quot;</span>
            &gt;</span>
              취소
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>
              <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isSubmitting</span> || <span class="hljs-attr">userIdAvailable</span> === <span class="hljs-string">false}</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50&quot;</span>
            &gt;</span>
              {isSubmitting ? &#x27;처리 중...&#x27; : &#x27;회원가입&#x27;}
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<hr>
<h2 id="-플랫폼별-상세-플로우">🔄 플랫폼별 상세 플로우</h2>
<h3 id="1-google-로그인-플로우">1. Google 로그인 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant User as 👤 사용자
    participant Frontend as 🌐 프론트엔드
    participant GSI as 🔍 Google GSI
    participant AuthService as 🔐 AuthService
    participant GoogleAPI as 📡 Google API
    participant DB as 🗄️ Database
    
    User-&gt;&gt;Frontend: &quot;Google로 시작하기&quot; 클릭
    Frontend-&gt;&gt;GSI: google.accounts.id.initialize()
    GSI-&gt;&gt;User: Google 로그인 팝업 표시
    User-&gt;&gt;GSI: 계정 선택 및 로그인
    GSI-&gt;&gt;Frontend: handleCredentialResponse(idToken)
    
    Frontend-&gt;&gt;AuthService: POST /api/auth/social/google&lt;br/&gt;{idToken, deviceInfo}
    AuthService-&gt;&gt;GoogleAPI: GET /oauth2/v3/tokeninfo?id_token=...
    GoogleAPI-&gt;&gt;AuthService: 사용자 정보 응답
    AuthService-&gt;&gt;DB: 3단계 자동 판단 로직 실행
    DB-&gt;&gt;AuthService: 사용자 정보 반환
    AuthService-&gt;&gt;Frontend: JWT + 사용자 정보 응답
    Frontend-&gt;&gt;User: 로그인 완료 또는 회원가입 폼
</pre>
<h3 id="2-카카오-로그인-플로우">2. 카카오 로그인 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant User as 👤 사용자
    participant Frontend as 🌐 프론트엔드
    participant KakaoSDK as 🍊 Kakao SDK
    participant AuthService as 🔐 AuthService
    participant KakaoAPI as 📡 Kakao API
    participant DB as 🗄️ Database
    
    User-&gt;&gt;Frontend: &quot;카카오로 시작하기&quot; 클릭
    Frontend-&gt;&gt;KakaoSDK: Kakao.Auth.createLoginButton()
    KakaoSDK-&gt;&gt;User: 카카오 로그인 페이지
    User-&gt;&gt;KakaoSDK: 카카오 계정 로그인
    KakaoSDK-&gt;&gt;Frontend: success(accessToken)
    
    Frontend-&gt;&gt;AuthService: POST /api/auth/social/kakao&lt;br/&gt;{accessToken, deviceInfo}
    AuthService-&gt;&gt;KakaoAPI: GET /v2/user/me&lt;br/&gt;Authorization: Bearer {accessToken}
    KakaoAPI-&gt;&gt;AuthService: 사용자 정보 응답&lt;br/&gt;{id, kakao_account: {email, profile}}
    AuthService-&gt;&gt;DB: 3단계 자동 판단 로직 실행
    DB-&gt;&gt;AuthService: 사용자 정보 반환
    AuthService-&gt;&gt;Frontend: JWT + 사용자 정보 응답
    Frontend-&gt;&gt;User: 로그인 완료 또는 회원가입 폼
</pre>
<h3 id="3-네이버-로그인-플로우-팝업-방식">3. 네이버 로그인 플로우 (팝업 방식)</h3>
<pre class="mermaid">sequenceDiagram
    participant User as 👤 사용자
    participant Frontend as 🌐 프론트엔드
    participant Popup as 🔗 팝업창
    participant AuthService as 🔐 AuthService
    participant NaverOAuth as 🟢 네이버 OAuth
    participant NaverAPI as 📡 네이버 API
    participant DB as 🗄️ Database
    
    User-&gt;&gt;Frontend: &quot;네이버로 시작하기&quot; 클릭
    Frontend-&gt;&gt;Popup: window.open('/api/auth/social/naver/login')
    Popup-&gt;&gt;AuthService: GET /api/auth/social/naver/login
    AuthService-&gt;&gt;NaverOAuth: redirect to 네이버 인증 페이지
    NaverOAuth-&gt;&gt;User: 네이버 로그인 페이지 표시
    User-&gt;&gt;NaverOAuth: 네이버 계정 로그인
    NaverOAuth-&gt;&gt;AuthService: GET /api/auth/social/naver/callback?code=...&amp;state=...
    
    AuthService-&gt;&gt;NaverOAuth: POST /oauth2.0/token&lt;br/&gt;{code, client_id, client_secret}
    NaverOAuth-&gt;&gt;AuthService: {access_token}
    AuthService-&gt;&gt;NaverAPI: GET /v1/nid/me&lt;br/&gt;Authorization: Bearer {access_token}
    NaverAPI-&gt;&gt;AuthService: 사용자 정보 응답&lt;br/&gt;{response: {id, email, name}}
    AuthService-&gt;&gt;DB: 3단계 자동 판단 로직 실행
    DB-&gt;&gt;AuthService: 사용자 정보 반환
    
    alt 로그인 성공
        AuthService-&gt;&gt;Popup: HTML + postMessage('NAVER_LOGIN_SUCCESS')
        Popup-&gt;&gt;Frontend: window.opener.postMessage({type: 'NAVER_LOGIN_SUCCESS'})
        Frontend-&gt;&gt;User: 로그인 완료
    else 회원가입 필요
        AuthService-&gt;&gt;Popup: HTML + postMessage('NAVER_SIGNUP_NEEDED')
        Popup-&gt;&gt;Frontend: window.opener.postMessage({type: 'NAVER_SIGNUP_NEEDED'})
        Frontend-&gt;&gt;User: 회원가입 폼 표시
    end
</pre>
<hr>
<hr>
<h2 id="-소셜-로그인-절차">🔐 소셜 로그인 절차</h2>
<h3 id="1-google-소셜-로그인-플로우">1. Google 소셜 로그인 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant U as 사용자
    participant C as 클라이언트(앱/웹)
    participant A as AuthService
    participant G as Google API
    participant DB as Database
    participant R as Redis
    
    U-&gt;&gt;C: 1. Google 로그인 버튼 클릭
    C-&gt;&gt;G: 2. Google OAuth 인증 요청
    G-&gt;&gt;U: 3. Google 로그인 페이지 표시
    U-&gt;&gt;G: 4. 계정 정보 입력 &amp; 동의
    G-&gt;&gt;C: 5. ID Token 발급
    
    C-&gt;&gt;A: 6. POST /api/auth/social/google
    Note over C,A: { &quot;idToken&quot;: &quot;google_id_token&quot; }
    
    A-&gt;&gt;G: 7. ID Token 검증
    G-&gt;&gt;A: 8. 사용자 정보 반환
    Note over G,A: { sub, email, name, picture, email_verified }
    
    A-&gt;&gt;DB: 9. 소셜 계정 조회/생성
    DB-&gt;&gt;A: 10. 사용자 정보 반환
    
    A-&gt;&gt;A: 11. JWT 토큰 생성
    A-&gt;&gt;R: 12. 토큰 캐싱
    
    A-&gt;&gt;C: 13. 로그인 응답
    Note over A,C: { accessToken, refreshToken, userInfo }
    
    C-&gt;&gt;U: 14. 로그인 완료 화면
</pre>
<h3 id="2-kakao-소셜-로그인-플로우">2. Kakao 소셜 로그인 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant U as 사용자
    participant C as 클라이언트
    participant A as AuthService
    participant K as Kakao API
    participant DB as Database
    participant R as Redis
    
    U-&gt;&gt;C: 1. 카카오 로그인 버튼 클릭
    C-&gt;&gt;K: 2. 카카오 OAuth 인증 요청
    K-&gt;&gt;U: 3. 카카오 로그인 페이지
    U-&gt;&gt;K: 4. 로그인 &amp; 동의
    K-&gt;&gt;C: 5. Access Token 발급
    
    C-&gt;&gt;A: 6. POST /api/auth/social/kakao
    Note over C,A: { &quot;accessToken&quot;: &quot;kakao_access_token&quot; }
    
    A-&gt;&gt;K: 7. 사용자 정보 조회
    K-&gt;&gt;A: 8. 사용자 정보 반환
    Note over K,A: { id, kakao_account: { email, profile: { nickname, profile_image_url } } }
    
    A-&gt;&gt;DB: 9. 소셜 계정 처리
    A-&gt;&gt;A: 10. JWT 토큰 생성
    A-&gt;&gt;R: 11. 토큰 캐싱
    A-&gt;&gt;C: 12. 로그인 응답
    C-&gt;&gt;U: 13. 로그인 완료
</pre>
<h3 id="3-naver-소셜-로그인-플로우">3. Naver 소셜 로그인 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant U as 사용자
    participant C as 클라이언트
    participant A as AuthService
    participant N as Naver API
    participant DB as Database
    participant R as Redis
    
    U-&gt;&gt;C: 1. 네이버 로그인 버튼 클릭
    C-&gt;&gt;N: 2. 네이버 OAuth 인증 요청
    N-&gt;&gt;U: 3. 네이버 로그인 페이지
    U-&gt;&gt;K: 4. 로그인 &amp; 동의
    N-&gt;&gt;C: 5. Access Token 발급
    
    C-&gt;&gt;A: 6. POST /api/auth/social/naver
    Note over C,A: { &quot;accessToken&quot;: &quot;naver_access_token&quot; }
    
    A-&gt;&gt;N: 7. 사용자 정보 조회
    N-&gt;&gt;A: 8. 사용자 정보 반환
    Note over N,A: { resultcode: &quot;00&quot;, response: { id, email, name, nickname, profile_image } }
    
    A-&gt;&gt;DB: 9. 소셜 계정 처리
    A-&gt;&gt;A: 10. JWT 토큰 생성
    A-&gt;&gt;R: 11. 토큰 캐싱
    A-&gt;&gt;C: 12. 로그인 응답
    C-&gt;&gt;U: 13. 로그인 완료
</pre>
<hr>
<h2 id="-소셜-회원가입-절차">👤 소셜 회원가입 절차</h2>
<h3 id="소셜-회원가입-통합-플로우">소셜 회원가입 통합 플로우</h3>
<pre class="mermaid">sequenceDiagram
    participant U as 사용자
    participant C as 클라이언트
    participant A as AuthService
    participant S as 소셜 플랫폼
    participant DB as Database
    participant R as Redis
    
    U-&gt;&gt;C: 1. 소셜 회원가입 선택
    C-&gt;&gt;S: 2. 소셜 인증 요청
    S-&gt;&gt;U: 3. 로그인 페이지 표시
    U-&gt;&gt;S: 4. 인증 &amp; 동의
    S-&gt;&gt;C: 5. 소셜 토큰 발급
    
    C-&gt;&gt;U: 6. 추가 정보 입력 폼 표시
    Note over C,U: userId, 전화번호, 약관 동의
    U-&gt;&gt;C: 7. 추가 정보 입력
    
    C-&gt;&gt;A: 8. POST /api/auth/social/signup
    Note over C,A: { provider, socialToken, userId, phone, termsAgreed, privacyAgreed }
    
    A-&gt;&gt;S: 9. 소셜 토큰으로 사용자 정보 조회
    S-&gt;&gt;A: 10. 소셜 사용자 정보 반환
    
    A-&gt;&gt;DB: 11. userId 중복 확인
    DB-&gt;&gt;A: 12. 중복 여부 응답
    
    alt userId 중복인 경우
        A-&gt;&gt;C: 13. 중복 오류 응답
        C-&gt;&gt;U: 14. 다른 아이디 입력 요청
    else userId 사용 가능
        A-&gt;&gt;DB: 15. 새 사용자 생성
        A-&gt;&gt;DB: 16. 소셜 계정 연결
        A-&gt;&gt;A: 17. JWT 토큰 생성
        A-&gt;&gt;R: 18. 토큰 캐싱
        A-&gt;&gt;C: 19. 회원가입 성공 응답
        C-&gt;&gt;U: 20. 회원가입 완료 화면
    end
</pre>
<hr>
<h2 id="판단-플로우-다이어그램">판단 플로우 다이어그램</h2>
<pre class="mermaid">flowchart TD
    A[소셜 토큰 수신] --&gt; B[소셜 사용자 정보 추출]
    B --&gt; C{1️⃣ 소셜 ID로 기존 계정 찾기}
    
    C --&gt;|찾음| D[🟢 즉시 로그인]
    C --&gt;|못찾음| E{2️⃣ 이메일로 기존 사용자 찾기}
    
    E --&gt;|찾음| F[🔗 소셜 계정 연결]
    F --&gt; G[🟢 연결 후 로그인]
    
    E --&gt;|못찾음| H[🆕 신규 사용자 생성]
    H --&gt; I{3️⃣ 추가 정보 충분한가?}
    
    I --&gt;|충분함| J[🟢 자동 생성 후 로그인]
    I --&gt;|부족함| K[⚠️ 소셜 회원가입 필요]
    
    K --&gt; L[사용자가 추가 정보 입력]
    L --&gt; M[🟢 회원가입 완료 후 로그인]
</pre>
<hr>
<h2 id="-데이터-구조-및-api-스펙">� 데이터 구조 및 API 스펙</h2>
<h3 id="1-요청-데이터-구조">1. 요청 데이터 구조</h3>
<h4 id="google-로그인-요청-googleloginrequest">Google 로그인 요청 (GoogleLoginRequest)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;idToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WEB_BROWSER&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// WEB_BROWSER, MOBILE_APP, ADMIN_WEB</span>
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;browser-fingerprint-uuid&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;appVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="카카오-로그인-요청-kakaologinrequest">카카오 로그인 요청 (KakaoLoginRequest)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kEWG7tLkJc3eDpNpOo8TCCoTsCYadJ5F_access_token&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MOBILE_APP&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;device-unique-id&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;appVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.1.0&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="네이버-로그인-요청-naverloginrequest">네이버 로그인 요청 (NaverLoginRequest)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AAAANVl6Y8PgC8HsssEQutadsd_access_token&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="소셜-회원가입-요청-socialsignuprequest">소셜 회원가입 요청 (SocialSignUpRequest)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GOOGLE&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// GOOGLE, KAKAO, NAVER</span>
  <span class="hljs-attr">&quot;socialToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;social_platform_token&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user_unique_id&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;010-1234-5678&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;termsAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;privacyAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;marketingAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="2-응답-데이터-구조">2. 응답 데이터 구조</h3>
<h4 id="통합-소셜-로그인-응답-socialloginresponse">통합 소셜 로그인 응답 (SocialLoginResponse)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzUxMiJ9.eyJ1c2VySWQiOiI...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;refreshToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4f8b1c2e-3d4a-5b6c-7d8e-9f0a1b2c3d4e&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;tokenType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Bearer&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;expiresIn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;member-uuid-1234&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user@gmail.com&quot;</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;홍길동&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://profile-image-url&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;USER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;isNewUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;needsAdditionalInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;needsUsernameInput&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span> 
  <span class="hljs-attr">&quot;needsAccountLink&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Google 로그인이 완료되었습니다!&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="소셜-회원가입-응답-socialsignupresponse">소셜 회원가입 응답 (SocialSignUpResponse)</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;회원가입이 완료되었습니다!&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzUxMiJ9...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;refreshToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;refresh-token-uuid&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;tokenType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Bearer&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;expiresIn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new-member-uuid&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;newuser@gmail.com&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;김신규&quot;</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://profile-image-url&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GOOGLE&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;USER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;needsAdditionalInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="3-중간-처리-데이터-socialuserinfo">3. 중간 처리 데이터 (SocialUserInfo)</h3>
<p><strong>플랫폼별 사용자 정보 통합 클래스</strong>:</p>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;google&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// google, kakao, naver</span>
  <span class="hljs-attr">&quot;socialId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;108234567890123456789&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user@gmail.com&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;홍길동&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://profile-image-url&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;emailVerified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;phoneNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;010-1234-5678&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;locale&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ko_KR&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;collectionChannel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mobile_app&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;providedInfoMask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span>  <span class="hljs-comment">// 비트마스크로 제공된 정보 표시</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="4-데이터베이스-구조">4. 데이터베이스 구조</h3>
<h4 id="members-테이블">members 테이블</h4>
<pre><code class="language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> members (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    member_uuid <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span>,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    user_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">UNIQUE</span>,
    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),
    profile_image_url TEXT,
    role <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;USER&#x27;</span>,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;ACTIVE&#x27;</span>,
    last_login_at <span class="hljs-type">TIMESTAMP</span>,
    created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<h4 id="member_social_accounts-테이블">member_social_accounts 테이블</h4>
<pre><code class="language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> member_social_accounts (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    member_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    provider <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  <span class="hljs-comment">-- GOOGLE, KAKAO, NAVER</span>
    social_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    profile_image_url TEXT,
    is_primary <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    last_used_at <span class="hljs-type">TIMESTAMP</span>,
    created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    
    <span class="hljs-keyword">FOREIGN</span> KEY (member_id) <span class="hljs-keyword">REFERENCES</span> members(id),
    <span class="hljs-keyword">UNIQUE</span> KEY unique_social_account (provider, social_id)
);
</code></pre>
<hr>
<h2 id="-테스트-및-디버깅-가이드">🧪 테스트 및 디버깅 가이드</h2>
<h3 id="3-백엔드-개발-모드-설정">3. 백엔드 개발 모드 설정</h3>
<h4 id="31-applicationyml-개발-설정">3.1 application.yml 개발 설정</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># AuthService의 application-dev.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>
    
<span class="hljs-attr">social:</span>
  <span class="hljs-attr">google:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">${GOOGLE_CLIENT_ID:YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com}</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 더미 데이터 사용</span>
    <span class="hljs-attr">token-info-url:</span> <span class="hljs-string">https://oauth2.googleapis.com/tokeninfo</span>
    
  <span class="hljs-attr">kakao:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">${KAKAO_REST_API_KEY:your-kakao-rest-api-key}</span>
    <span class="hljs-attr">user-info-url:</span> <span class="hljs-string">https://kapi.kakao.com/v2/user/me</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 더미 데이터 사용</span>
    
  <span class="hljs-attr">naver:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">${NAVER_CLIENT_ID:YOUR_NAVER_CLIENT_ID}</span>
    <span class="hljs-attr">client-secret:</span> <span class="hljs-string">${NAVER_CLIENT_SECRET:your-naver-client-secret}</span>
    <span class="hljs-attr">redirect-uri:</span> <span class="hljs-string">http://localhost:8082/api/auth/social/naver/callback</span>
    <span class="hljs-attr">auth-url:</span> <span class="hljs-string">https://nid.naver.com/oauth2.0/authorize</span>
    <span class="hljs-attr">token-url:</span> <span class="hljs-string">https://nid.naver.com/oauth2.0/token</span>
    <span class="hljs-attr">user-info-url:</span> <span class="hljs-string">https://openapi.naver.com/v1/nid/me</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 더미 데이터 사용</span>

<span class="hljs-attr">jwt:</span>
  <span class="hljs-attr">secret:</span> <span class="hljs-string">${JWT_SECRET:YOUR_JWT_SECRET_KEY_HERE}</span>
  <span class="hljs-attr">access-token-expiry:</span> <span class="hljs-number">3600</span>  <span class="hljs-comment"># 1시간</span>
  <span class="hljs-attr">refresh-token-expiry:</span> <span class="hljs-number">86400</span>  <span class="hljs-comment"># 24시간</span>

<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.akc.b2c.authservice.service.social:</span> <span class="hljs-string">DEBUG</span>
    <span class="hljs-attr">org.springframework.web:</span> <span class="hljs-string">DEBUG</span>
    <span class="hljs-attr">org.springframework.security:</span> <span class="hljs-string">DEBUG</span>
</code></pre>
<h4 id="32-개발-모드-더미-데이터">3.2 개발 모드 더미 데이터</h4>
<pre><code class="language-java"><span class="hljs-comment">// GoogleAuthService.java의 개발 모드 더미 데이터</span>
<span class="hljs-keyword">private</span> SocialUserInfo <span class="hljs-title function_">createDummyGoogleUserInfo</span><span class="hljs-params">(String idToken)</span> {
    <span class="hljs-keyword">return</span> SocialUserInfo.builder()
            .provider(<span class="hljs-string">&quot;google&quot;</span>)
            .socialId(<span class="hljs-string">&quot;dummy_google_&quot;</span> + System.currentTimeMillis())
            .email(<span class="hljs-string">&quot;dev.google@test.com&quot;</span>)
            .name(<span class="hljs-string">&quot;구글 테스트 사용자&quot;</span>)
            .profileImageUrl(<span class="hljs-string">&quot;https://lh3.googleusercontent.com/a/default-user=s96-c&quot;</span>)
            .emailVerified(<span class="hljs-literal">true</span>)
            .locale(<span class="hljs-string">&quot;ko_KR&quot;</span>)
            .build();
}

<span class="hljs-comment">// KakaoAuthService.java의 개발 모드 더미 데이터</span>
<span class="hljs-keyword">private</span> SocialUserInfo <span class="hljs-title function_">createDevModeUserInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> SocialUserInfo.builder()
            .provider(<span class="hljs-string">&quot;kakao&quot;</span>)
            .socialId(<span class="hljs-string">&quot;dummy_kakao_&quot;</span> + System.currentTimeMillis())
            .email(<span class="hljs-string">&quot;dev.kakao@test.com&quot;</span>)
            .name(<span class="hljs-string">&quot;카카오 테스트 사용자&quot;</span>)
            .profileImageUrl(<span class="hljs-string">&quot;https://k.kakaocdn.net/dn/default_profile.png&quot;</span>)
            .emailVerified(<span class="hljs-literal">true</span>)
            .build();
}

<span class="hljs-comment">// NaverAuthService.java의 개발 모드 더미 데이터</span>
<span class="hljs-keyword">private</span> SocialUserInfo <span class="hljs-title function_">createDummyNaverUserInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> SocialUserInfo.builder()
            .provider(<span class="hljs-string">&quot;naver&quot;</span>)
            .socialId(<span class="hljs-string">&quot;dummy_naver_&quot;</span> + System.currentTimeMillis())
            .email(<span class="hljs-string">&quot;dev.naver@test.com&quot;</span>)
            .name(<span class="hljs-string">&quot;네이버 테스트 사용자&quot;</span>)
            .profileImageUrl(<span class="hljs-string">&quot;https://ssl.pstatic.net/static/pwe/address/img_profile.png&quot;</span>)
            .emailVerified(<span class="hljs-literal">true</span>)
            .build();
}
</code></pre>
<h3 id="4-플랫폼별-테스트-시나리오">4. 플랫폼별 테스트 시나리오</h3>
<h4 id="41-google-로그인-테스트">4.1 Google 로그인 테스트</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 개발 모드 테스트 (더미 토큰)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">testGoogleLogin</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://localhost:8082/api/auth/social/google&#x27;</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">idToken</span>: <span class="hljs-string">&#x27;dummy_google_id_token_for_dev&#x27;</span>,
            <span class="hljs-attr">deviceInfo</span>: {
                <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span>,
                <span class="hljs-attr">deviceId</span>: <span class="hljs-string">&#x27;test-device-&#x27;</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
            }
        })
    });
};
</code></pre>
<h4 id="42-카카오-로그인-테스트">4.2 카카오 로그인 테스트</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 개발 모드 테스트 (더미 토큰)  </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">testKakaoLogin</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://localhost:8082/api/auth/social/kakao&#x27;</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">accessToken</span>: <span class="hljs-string">&#x27;dummy_kakao_access_token_for_dev&#x27;</span>,
            <span class="hljs-attr">deviceInfo</span>: {
                <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span>,
                <span class="hljs-attr">deviceId</span>: <span class="hljs-string">&#x27;test-device-&#x27;</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
            }
        })
    });
};
</code></pre>
<h4 id="43-네이버-로그인-테스트">4.3 네이버 로그인 테스트</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 팝업 방식 테스트</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">testNaverLogin</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">const</span> popup = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(
        <span class="hljs-string">&#x27;http://localhost:8082/api/auth/social/naver/login&#x27;</span>,
        <span class="hljs-string">&#x27;naverTest&#x27;</span>,
        <span class="hljs-string">&#x27;width=500,height=600&#x27;</span>
    );
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">origin</span> !== <span class="hljs-string">&#x27;http://localhost:8082&#x27;</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;네이버 로그인 결과:&#x27;</span>, event.<span class="hljs-property">data</span>);
    });
};
</code></pre>
<h3 id="5-백엔드-로그-모니터링">5. 백엔드 로그 모니터링</h3>
<h4 id="51-주요-로그-포인트">5.1 주요 로그 포인트</h4>
<pre><code class="language-bash"><span class="hljs-comment"># AuthService 로그 실시간 모니터링</span>
<span class="hljs-built_in">tail</span> -f /path/to/authservice.log | grep -E <span class="hljs-string">&quot;(Google|Kakao|Naver|소셜)&quot;</span>

<span class="hljs-comment"># 특정 패턴 필터링</span>
<span class="hljs-built_in">tail</span> -f /path/to/authservice.log | grep -E <span class="hljs-string">&quot;(로그인 처리 시작|사용자 정보|토큰 생성)&quot;</span>
</code></pre>
<h4 id="52-에러-디버깅">5.2 에러 디버깅</h4>
<pre><code class="language-bash"><span class="hljs-comment"># 토큰 검증 실패 로그</span>
grep <span class="hljs-string">&quot;토큰 검증 실패&quot;</span> /path/to/authservice.log

<span class="hljs-comment"># DB 연결 문제 로그  </span>
grep <span class="hljs-string">&quot;DB 처리 실패&quot;</span> /path/to/authservice.log

<span class="hljs-comment"># JWT 토큰 생성 오류</span>
grep <span class="hljs-string">&quot;JWT.*실패&quot;</span> /path/to/authservice.log
</code></pre>
<h3 id="6-api-테스트-스크립트">6. API 테스트 스크립트</h3>
<h4 id="61-curl을-이용한-api-테스트">6.1 cURL을 이용한 API 테스트</h4>
<pre><code class="language-bash"><span class="hljs-comment"># Google 로그인 테스트</span>
curl -X POST http://localhost:8082/api/auth/social/google \
  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \
  -d <span class="hljs-string">&#x27;{
    &quot;idToken&quot;: &quot;dummy_google_id_token&quot;,
    &quot;deviceInfo&quot;: {
      &quot;platform&quot;: &quot;WEB_BROWSER&quot;,
      &quot;deviceId&quot;: &quot;test-device&quot;
    }
  }&#x27;</span>

<span class="hljs-comment"># 카카오 로그인 테스트</span>
curl -X POST http://localhost:8082/api/auth/social/kakao \
  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \
  -d <span class="hljs-string">&#x27;{
    &quot;accessToken&quot;: &quot;dummy_kakao_access_token&quot;,
    &quot;deviceInfo&quot;: {
      &quot;platform&quot;: &quot;WEB_BROWSER&quot;,
      &quot;deviceId&quot;: &quot;test-device&quot;
    }
  }&#x27;</span>

<span class="hljs-comment"># 네이버 로그인 테스트 (Access Token 방식)</span>
curl -X POST http://localhost:8082/api/auth/social/naver \
  -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \
  -d <span class="hljs-string">&#x27;{
    &quot;accessToken&quot;: &quot;dummy_naver_access_token&quot;
  }&#x27;</span>

<span class="hljs-comment"># 지원 플랫폼 확인</span>
curl -X GET http://localhost:8082/api/auth/social/providers

<span class="hljs-comment"># 헬스체크</span>
curl -X GET http://localhost:8082/api/auth/social/health
</code></pre>
<h3 id="7-일반적인-문제-및-해결방법">7. 일반적인 문제 및 해결방법</h3>
<h4 id="71-문제-cors-오류">7.1 문제: CORS 오류</h4>
<pre><code>Access to fetch at 'http://localhost:8082/api/auth/social/google' 
from origin 'null' has been blocked by CORS policy
</code></pre>
<p><strong>백엔드 해결방법</strong>: SecurityConfig에서 CORS 설정 확인</p>
<pre><code class="language-java"><span class="hljs-comment">// SecurityConfig.java</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CorsConfigurationSource <span class="hljs-title function_">corsConfigurationSource</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();
        configuration.setAllowedOriginPatterns(Arrays.asList(
            <span class="hljs-string">&quot;http://localhost:3011&quot;</span>, 
            <span class="hljs-string">&quot;http://localhost:3010&quot;</span>, 
            <span class="hljs-string">&quot;http://localhost:3000&quot;</span>,  <span class="hljs-comment">// Next.js 개발 서버</span>
            <span class="hljs-string">&quot;file://*&quot;</span>  <span class="hljs-comment">// 로컬 HTML 파일 허용</span>
        ));
        configuration.setAllowedMethods(Arrays.asList(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>, <span class="hljs-string">&quot;OPTIONS&quot;</span>));
        configuration.setAllowedHeaders(Arrays.asList(<span class="hljs-string">&quot;*&quot;</span>));
        configuration.setAllowCredentials(<span class="hljs-literal">true</span>);
        
        <span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>();
        source.registerCorsConfiguration(<span class="hljs-string">&quot;/api/**&quot;</span>, configuration);
        <span class="hljs-keyword">return</span> source;
    }
}
</code></pre>
<p><strong>프론트엔드 해결방법</strong>: 개발 환경에서 프록시 설정</p>
<pre><code class="language-typescript"><span class="hljs-comment">// next.config.js (Next.js)</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">rewrites</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">source</span>: <span class="hljs-string">&#x27;/api/auth/:path*&#x27;</span>,
        <span class="hljs-attr">destination</span>: <span class="hljs-string">&#x27;http://localhost:8082/api/auth/:path*&#x27;</span>
      }
    ];
  }
};
</code></pre>
<h4 id="72-문제-네이버-팝업-차단">7.2 문제: 네이버 팝업 차단</h4>
<p><strong>해결방법</strong>: 브라우저 팝업 허용 설정 또는 사용자 액션에서 팝업 호출</p>
<h4 id="73-문제-jwt-토큰-만료">7.3 문제: JWT 토큰 만료</h4>
<p><strong>백엔드 해결방법</strong>: RefreshToken을 이용한 토큰 갱신 로직 구현</p>
<pre><code class="language-java"><span class="hljs-comment">// JwtTokenProvider.java</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenProvider</span> {
    
    <span class="hljs-meta">@Value(&quot;${jwt.access-token-expiry:3600}&quot;)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> accessTokenExpiry;
    
    <span class="hljs-meta">@Value(&quot;${jwt.refresh-token-expiry:86400}&quot;)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> refreshTokenExpiry;
    
    <span class="hljs-keyword">public</span> TokenResponse <span class="hljs-title function_">refreshAccessToken</span><span class="hljs-params">(String refreshToken)</span> {
        <span class="hljs-keyword">if</span> (validateToken(refreshToken)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> getUserIdFromToken(refreshToken);
            <span class="hljs-type">String</span> <span class="hljs-variable">newAccessToken</span> <span class="hljs-operator">=</span> generateAccessToken(userId);
            
            <span class="hljs-keyword">return</span> TokenResponse.builder()
                    .accessToken(newAccessToken)
                    .refreshToken(refreshToken)  <span class="hljs-comment">// RefreshToken은 재사용</span>
                    .tokenType(<span class="hljs-string">&quot;Bearer&quot;</span>)
                    .expiresIn(accessTokenExpiry)
                    .build();
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidTokenException</span>(<span class="hljs-string">&quot;Invalid refresh token&quot;</span>);
    }
}
</code></pre>
<h3 id="1-로컬-테스트-환경-설정">1. 로컬 테스트 환경 설정</h3>
<h4 id="11-개발-환경-준비">1.1 개발 환경 준비</h4>
<pre><code class="language-bash"><span class="hljs-comment"># AuthService 실행</span>
<span class="hljs-built_in">cd</span> /Users/sangyonghan/development/Amano/akc-b2c/AuthService
./gradlew bootRun

<span class="hljs-comment"># 프론트엔드 개발 서버 실행 (Next.js 예시)</span>
<span class="hljs-built_in">cd</span> /path/to/frontend
npm run dev
</code></pre>
<h4 id="12-환경별-설정">1.2 환경별 설정</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// config/social-config.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getSocialConfig</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> environment = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span>;
  
  <span class="hljs-keyword">const</span> configs = {
    <span class="hljs-attr">development</span>: {
      <span class="hljs-attr">authServiceUrl</span>: <span class="hljs-string">&#x27;http://localhost:8082&#x27;</span>,
      <span class="hljs-attr">googleClientId</span>: <span class="hljs-string">&#x27;YOUR_GOOGLE_CLIENT_ID&#x27;</span>,
      <span class="hljs-attr">kakaoJsKey</span>: <span class="hljs-string">&#x27;YOUR_KAKAO_JAVASCRIPT_KEY&#x27;</span>,
      <span class="hljs-attr">enableDevMode</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">enableConsoleLogging</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-attr">staging</span>: {
      <span class="hljs-attr">authServiceUrl</span>: <span class="hljs-string">&#x27;https://staging-auth.example.com&#x27;</span>,
      <span class="hljs-attr">googleClientId</span>: <span class="hljs-string">&#x27;YOUR_STAGING_GOOGLE_CLIENT_ID&#x27;</span>,
      <span class="hljs-attr">kakaoJsKey</span>: <span class="hljs-string">&#x27;YOUR_STAGING_KAKAO_JS_KEY&#x27;</span>,
      <span class="hljs-attr">enableDevMode</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">enableConsoleLogging</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-attr">production</span>: {
      <span class="hljs-attr">authServiceUrl</span>: <span class="hljs-string">&#x27;https://auth.example.com&#x27;</span>,
      <span class="hljs-attr">googleClientId</span>: <span class="hljs-string">&#x27;YOUR_PROD_GOOGLE_CLIENT_ID&#x27;</span>,
      <span class="hljs-attr">kakaoJsKey</span>: <span class="hljs-string">&#x27;YOUR_PROD_KAKAO_JS_KEY&#x27;</span>,
      <span class="hljs-attr">enableDevMode</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">enableConsoleLogging</span>: <span class="hljs-literal">false</span>
    }
  };

  <span class="hljs-keyword">return</span> configs[environment <span class="hljs-keyword">as</span> keyof <span class="hljs-keyword">typeof</span> configs] || configs.<span class="hljs-property">development</span>;
};
</code></pre>
<h4 id="21-google-로그인-디버깅">2.1 Google 로그인 디버깅</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/googleDebugger.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> debugGoogleLogin = {
  <span class="hljs-comment">// Google SDK 상태 확인</span>
  <span class="hljs-attr">checkSDKStatus</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Google SDK 상태:&#x27;</span>, {
      <span class="hljs-attr">sdkLoaded</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>,
      <span class="hljs-attr">accountsAvailable</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>,
      <span class="hljs-attr">idAvailable</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span>?.<span class="hljs-property">id</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>
    });
  },

  <span class="hljs-comment">// ID Token 디코딩 (개발 환경에서만)</span>
  <span class="hljs-attr">decodeIdToken</span>: <span class="hljs-function">(<span class="hljs-params">idToken: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">&#x27;development&#x27;</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> payload = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title function_">atob</span>(idToken.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>]));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Google ID Token 페이로드:&#x27;</span>, {
        <span class="hljs-attr">iss</span>: payload.<span class="hljs-property">iss</span>,
        <span class="hljs-attr">aud</span>: payload.<span class="hljs-property">aud</span>,
        <span class="hljs-attr">sub</span>: payload.<span class="hljs-property">sub</span>,
        <span class="hljs-attr">email</span>: payload.<span class="hljs-property">email</span>,
        <span class="hljs-attr">email_verified</span>: payload.<span class="hljs-property">email_verified</span>,
        <span class="hljs-attr">exp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(payload.<span class="hljs-property">exp</span> * <span class="hljs-number">1000</span>),
        <span class="hljs-attr">iat</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(payload.<span class="hljs-property">iat</span> * <span class="hljs-number">1000</span>)
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;ID Token 디코딩 실패:&#x27;</span>, error);
    }
  },

  <span class="hljs-comment">// 네트워크 요청 로깅</span>
  <span class="hljs-attr">logNetworkRequest</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">idToken</span>: <span class="hljs-built_in">string</span>) =&gt; {
    <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Google API 요청 시작:&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>());
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/auth/social/google&#x27;</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ idToken })
      });
      
      <span class="hljs-keyword">const</span> endTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Google API 응답:&#x27;</span>, {
        <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
        <span class="hljs-attr">statusText</span>: response.<span class="hljs-property">statusText</span>,
        <span class="hljs-attr">duration</span>: <span class="hljs-string">`<span class="hljs-subst">${endTime - startTime}</span>ms`</span>,
        <span class="hljs-attr">headers</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">entries</span>())
      });
      
      <span class="hljs-keyword">return</span> response;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Google API 요청 실패:&#x27;</span>, error);
      <span class="hljs-keyword">throw</span> error;
    }
  }
};
</code></pre>
<h4 id="22-카카오-로그인-디버깅">2.2 카카오 로그인 디버깅</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/kakaoDebugger.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> debugKakaoLogin = {
  <span class="hljs-comment">// Kakao SDK 상태 확인</span>
  <span class="hljs-attr">checkSDKStatus</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Kakao SDK 상태:&#x27;</span>, {
      <span class="hljs-attr">sdkLoaded</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>,
      <span class="hljs-attr">initialized</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-title function_">isInitialized</span>(),
      <span class="hljs-attr">version</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-property">VERSION</span>
    });
  },

  <span class="hljs-comment">// 액세스 토큰 정보 확인</span>
  <span class="hljs-attr">checkAccessToken</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-property">Auth</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> accessToken = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>.<span class="hljs-property">Auth</span>.<span class="hljs-title function_">getAccessToken</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Kakao Access Token:&#x27;</span>, {
      <span class="hljs-attr">hasToken</span>: !!accessToken,
      <span class="hljs-attr">tokenLength</span>: accessToken?.<span class="hljs-property">length</span>,
      <span class="hljs-attr">tokenPreview</span>: accessToken ? <span class="hljs-string">`<span class="hljs-subst">${accessToken.substring(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)}</span>...`</span> : <span class="hljs-literal">null</span>
    });
  },

  <span class="hljs-comment">// 로그인 상태 확인</span>
  <span class="hljs-attr">checkLoginStatus</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>?.<span class="hljs-property">Auth</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">Kakao</span>.<span class="hljs-property">Auth</span>.<span class="hljs-title function_">getStatusInfo</span>(<span class="hljs-function">(<span class="hljs-params">statusInfo: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Kakao 로그인 상태:&#x27;</span>, statusInfo);
    });
  }
};
</code></pre>
<h4 id="23-네이버-로그인-디버깅">2.3 네이버 로그인 디버깅</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/naverDebugger.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> debugNaverLogin = {
  <span class="hljs-comment">// 팝업 상태 모니터링</span>
  <span class="hljs-attr">monitorPopup</span>: <span class="hljs-function">(<span class="hljs-params">popup: Window</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> checkInterval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (popup.<span class="hljs-property">closed</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;네이버 팝업이 닫혔습니다.&#x27;</span>);
        <span class="hljs-built_in">clearInterval</span>(checkInterval);
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;팝업 URL:&#x27;</span>, popup.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// Cross-origin 오류는 정상 (다른 도메인으로 이동 중)</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;팝업이 네이버 도메인으로 이동 중...&#x27;</span>);
      }
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-comment">// 30초 후 모니터링 중단</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(checkInterval), <span class="hljs-number">30000</span>);
  },

  <span class="hljs-comment">// 메시지 이벤트 로깅</span>
  <span class="hljs-attr">logPopupMessages</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> originalAddEventListener = <span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>;
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>, listener, options</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&#x27;message&#x27;</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">wrappedListener</span> = (<span class="hljs-params">event: MessageEvent</span>) =&gt; {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;팝업 메시지 수신:&#x27;</span>, {
            <span class="hljs-attr">origin</span>: event.<span class="hljs-property">origin</span>,
            <span class="hljs-attr">data</span>: event.<span class="hljs-property">data</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
          });
          
          <span class="hljs-keyword">return</span> listener.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, event);
        };
        
        <span class="hljs-keyword">return</span> originalAddEventListener.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-keyword">type</span>, wrappedListener, options);
      }
      
      <span class="hljs-keyword">return</span> originalAddEventListener.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-keyword">type</span>, listener, options);
    };
  }
};
</code></pre>
<h3 id="3-일반적인-문제-및-해결방법">3. 일반적인 문제 및 해결방법</h3>
<h4 id="31-cors-오류">3.1 CORS 오류</h4>
<p><strong>문제:</strong></p>
<pre><code>Access to fetch at 'http://localhost:8082/api/auth/social/google' 
from origin 'http://localhost:3000' has been blocked by CORS policy
</code></pre>
<p><strong>해결방법:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// 개발 환경에서 프록시 설정 (Next.js)</span>
<span class="hljs-comment">// next.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">rewrites</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">source</span>: <span class="hljs-string">&#x27;/api/auth/:path*&#x27;</span>,
        <span class="hljs-attr">destination</span>: <span class="hljs-string">&#x27;http://localhost:8082/api/auth/:path*&#x27;</span>
      }
    ];
  }
};

<span class="hljs-comment">// 또는 백엔드 CORS 설정 확인</span>
<span class="hljs-comment">// SecurityConfig.java에서 allowedOrigins 확인</span>
</code></pre>
<h4 id="32-sdk-로딩-실패">3.2 SDK 로딩 실패</h4>
<p><strong>문제:</strong> Google GSI 또는 Kakao SDK가 로드되지 않음</p>
<p><strong>해결방법:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// SDK 로딩 재시도 로직</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadSDKWithRetry</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url: <span class="hljs-built_in">string</span>, checkFn: () =&gt; <span class="hljs-built_in">boolean</span>, maxRetries = <span class="hljs-number">3</span></span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; maxRetries; i++) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadScript</span>(url);
      
      <span class="hljs-comment">// SDK 로드 확인을 위해 잠시 대기</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
      
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkFn</span>()) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SDK 로드 성공 (<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>번째 시도)`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`SDK 로드 실패 (<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>번째 시도):`</span>, error);
    }
    
    <span class="hljs-keyword">if</span> (i &lt; maxRetries - <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">2000</span>)); <span class="hljs-comment">// 2초 대기</span>
    }
  }
  
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;SDK 로드 최대 재시도 횟수 초과&#x27;</span>);
};

<span class="hljs-comment">// 사용 예시</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadSDKWithRetry</span>(
    <span class="hljs-string">&#x27;https://accounts.google.com/gsi/client&#x27;</span>,
    <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">google</span>?.<span class="hljs-property">accounts</span>?.<span class="hljs-property">id</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>
  );
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-comment">// Fallback UI 표시 또는 대체 로그인 방법 제공</span>
  <span class="hljs-title function_">showFallbackLoginOptions</span>();
}
</code></pre>
<h4 id="33-팝업-차단-문제">3.3 팝업 차단 문제</h4>
<p><strong>문제:</strong> 브라우저에서 네이버 로그인 팝업이 차단됨</p>
<p><strong>해결방법:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// 사용자 인터랙션 기반 팝업 열기</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">openPopupWithFallback</span> = (<span class="hljs-params">url: <span class="hljs-built_in">string</span>, name: <span class="hljs-built_in">string</span>, features: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> popup = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url, name, features);
  
  <span class="hljs-keyword">if</span> (!popup || popup.<span class="hljs-property">closed</span>) {
    <span class="hljs-comment">// 팝업이 차단된 경우 사용자에게 알림</span>
    <span class="hljs-keyword">const</span> userConfirmed = <span class="hljs-title function_">confirm</span>(
      <span class="hljs-string">&#x27;팝업이 차단되었습니다. 브라우저 설정에서 팝업을 허용하고 다시 시도하시겠습니까?&#x27;</span>
    );
    
    <span class="hljs-keyword">if</span> (userConfirmed) {
      <span class="hljs-comment">// 새 창으로 직접 이동</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = url;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-keyword">return</span> popup;
};
</code></pre>
<h4 id="34-네트워크-타임아웃">3.4 네트워크 타임아웃</h4>
<p><strong>문제:</strong> API 요청이 너무 오래 걸리거나 응답하지 않음</p>
<p><strong>해결방법:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// 타임아웃이 있는 fetch 래퍼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchWithTimeout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url: <span class="hljs-built_in">string</span>, options: RequestInit, timeout = <span class="hljs-number">10000</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  <span class="hljs-keyword">const</span> timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>(), timeout);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      ...options,
      <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>
    });
    
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    <span class="hljs-keyword">return</span> response;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> &amp;&amp; error.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;AbortError&#x27;</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`요청 시간 초과 (<span class="hljs-subst">${timeout}</span>ms)`</span>);
    }
    
    <span class="hljs-keyword">throw</span> error;
  }
};
</code></pre>
<h3 id="4-로깅-및-모니터링">4. 로깅 및 모니터링</h3>
<h4 id="41-구조화된-로깅">4.1 구조화된 로깅</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/logger.ts</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LogEvent</span> {
  <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;debug&#x27;</span> | <span class="hljs-string">&#x27;info&#x27;</span> | <span class="hljs-string">&#x27;warn&#x27;</span> | <span class="hljs-string">&#x27;error&#x27;</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  context?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  timestamp?: <span class="hljs-built_in">string</span>;
  provider?: <span class="hljs-built_in">string</span>;
  userId?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SocialLoginLogger</span> {
  <span class="hljs-keyword">private</span> isDevelopment = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span>;
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">event: LogEvent</span>) {
    <span class="hljs-keyword">const</span> logEntry = {
      ...event,
      <span class="hljs-attr">timestamp</span>: event.<span class="hljs-property">timestamp</span> || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
      <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
      <span class="hljs-attr">url</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>
    };
    
    <span class="hljs-comment">// 개발 환경에서는 콘솔에 출력</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDevelopment</span>) {
      <span class="hljs-variable language_">console</span>[event.<span class="hljs-property">level</span>](event.<span class="hljs-property">message</span>, logEntry);
    }
    
    <span class="hljs-comment">// 프로덕션에서는 로그 수집 서비스로 전송</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDevelopment</span> &amp;&amp; event.<span class="hljs-property">level</span> !== <span class="hljs-string">&#x27;debug&#x27;</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendToLogService</span>(logEntry);
    }
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendToLogService</span>(<span class="hljs-params">logEntry: LogEvent</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/logs&#x27;</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(logEntry)
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// 로그 전송 실패는 조용히 처리</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;로그 전송 실패:&#x27;</span>, error);
    }
  }
  
  <span class="hljs-title function_">debug</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, context?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;debug&#x27;</span>, message, context });
  }
  
  <span class="hljs-title function_">info</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, context?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;info&#x27;</span>, message, context });
  }
  
  <span class="hljs-title function_">warn</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, context?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;warn&#x27;</span>, message, context });
  }
  
  <span class="hljs-title function_">error</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, context?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;error&#x27;</span>, message, context });
  }
  
  <span class="hljs-title function_">socialLoginStart</span>(<span class="hljs-params">provider: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인 시작`</span>, { provider });
  }
  
  <span class="hljs-title function_">socialLoginSuccess</span>(<span class="hljs-params">provider: <span class="hljs-built_in">string</span>, isNewUser: <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인 성공`</span>, { provider, isNewUser });
  }
  
  <span class="hljs-title function_">socialLoginError</span>(<span class="hljs-params">provider: <span class="hljs-built_in">string</span>, error: <span class="hljs-built_in">Error</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인 실패`</span>, {
      provider,
      <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>,
      <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>
    });
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> logger = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SocialLoginLogger</span>();
</code></pre>
<h4 id="42-성능-모니터링">4.2 성능 모니터링</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// utils/performanceMonitor.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> performanceMonitor = {
  <span class="hljs-attr">measureSocialLogin</span>: <span class="hljs-function">(<span class="hljs-params">provider: <span class="hljs-built_in">string</span>, operation: () =&gt; <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> startTimestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    
    logger.<span class="hljs-title function_">debug</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 성능 측정 시작`</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">operation</span>().<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> duration = performance.<span class="hljs-title function_">now</span>() - startTime;
      <span class="hljs-keyword">const</span> endTimestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 성능 측정 완료`</span>, {
        provider,
        <span class="hljs-attr">duration</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(duration),
        startTimestamp,
        endTimestamp
      });
      
      <span class="hljs-comment">// 성능 임계값 확인 (5초 이상이면 경고)</span>
      <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">5000</span>) {
        logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인이 예상보다 오래 걸림`</span>, {
          provider,
          <span class="hljs-attr">duration</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(duration)
        });
      }
    });
  }
};
</code></pre>
<hr>
<h2 id="-핵심-특징-요약">🎯 핵심 특징 요약</h2>
<h3 id="통합-인증-시스템의-장점">통합 인증 시스템의 장점</h3>
<ol>
<li><strong>일관된 사용자 경험</strong>: 모든 소셜 플랫폼에서 동일한 플로우</li>
<li><strong>자동 계정 연결</strong>: 같은 이메일로 여러 소셜 계정 통합 관리</li>
<li><strong>유연한 회원가입</strong>: 필요시에만 추가 정보 수집</li>
<li><strong>개발자 친화적</strong>: 개발 모드 지원으로 쉬운 테스트</li>
</ol>
<h3 id="6-보안-및-모범-사례-가이드">6. 보안 및 모범 사례 가이드</h3>
<h4 id="61-프론트엔드-보안-고려사항">6.1 프론트엔드 보안 고려사항</h4>
<p><strong>토큰 저장 방식:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// 보안 등급별 토큰 저장 방법</span>

<span class="hljs-comment">// 1. 최고 보안 (권장) - httpOnly 쿠키</span>
<span class="hljs-comment">// 백엔드에서 Set-Cookie 헤더로 설정</span>
<span class="hljs-comment">// 프론트엔드에서는 접근 불가능하지만 자동으로 요청에 포함</span>

<span class="hljs-comment">// 2. 높은 보안 - Secure Storage (모바일)</span>
<span class="hljs-comment">// React Native의 Keychain (iOS) / KeyStore (Android)</span>

<span class="hljs-comment">// 3. 중간 보안 - sessionStorage (웹)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">storeTokenSecurely</span> = (<span class="hljs-params">accessToken: <span class="hljs-built_in">string</span>, refreshToken: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 세션 스토리지는 탭 닫히면 자동 삭제</span>
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;accessToken&#x27;</span>, accessToken);
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;refreshToken&#x27;</span>, refreshToken);
  
  <span class="hljs-comment">// 토큰 만료 시간 저장</span>
  <span class="hljs-keyword">const</span> expiresAt = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + (<span class="hljs-number">3600</span> * <span class="hljs-number">1000</span>); <span class="hljs-comment">// 1시간</span>
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;tokenExpiresAt&#x27;</span>, expiresAt.<span class="hljs-title function_">toString</span>());
};

<span class="hljs-comment">// 4. 낮은 보안 - localStorage (개발 환경에만 사용)</span>
<span class="hljs-comment">// 프로덕션에서는 사용 금지</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;accessToken&#x27;</span>, accessToken);
}
</code></pre>
<p><strong>CSRF 방지:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// CSRF 토큰 처리</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> apiClient = {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, options: RequestInit = {}</span>) {
    <span class="hljs-comment">// CSRF 토큰을 헤더에 추가</span>
    <span class="hljs-keyword">const</span> csrfToken = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;meta[name=&quot;csrf-token&quot;]&#x27;</span>)?.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;content&#x27;</span>);
    
    <span class="hljs-keyword">const</span> <span class="hljs-attr">defaultOptions</span>: <span class="hljs-title class_">RequestInit</span> = {
      <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>, <span class="hljs-comment">// 쿠키 자동 포함</span>
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
        <span class="hljs-string">&#x27;X-Requested-With&#x27;</span>: <span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>, <span class="hljs-comment">// CSRF 방지</span>
        ...(csrfToken &amp;&amp; { <span class="hljs-string">&#x27;X-CSRF-Token&#x27;</span>: csrfToken }),
        ...options.<span class="hljs-property">headers</span>
      }
    };

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url, { ...defaultOptions, ...options });
  }
};
</code></pre>
<p><strong>개인정보 보호:</strong></p>
<pre><code class="language-typescript"><span class="hljs-comment">// 민감한 정보 로깅 방지</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sanitizeUserInfo</span> = (<span class="hljs-params">userInfo: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> { email, phone, ...safeInfo } = userInfo;
  
  <span class="hljs-keyword">return</span> {
    ...safeInfo,
    <span class="hljs-attr">email</span>: email ? <span class="hljs-string">`<span class="hljs-subst">${email.substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)}</span>***@<span class="hljs-subst">${email.split(<span class="hljs-string">&#x27;@&#x27;</span>)[<span class="hljs-number">1</span>]}</span>`</span> : <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">phone</span>: phone ? <span class="hljs-string">`<span class="hljs-subst">${phone.substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)}</span>****<span class="hljs-subst">${phone.substring(<span class="hljs-number">7</span>)}</span>`</span> : <span class="hljs-literal">undefined</span>
  };
};

<span class="hljs-comment">// 개발 환경에서만 상세 로그</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">logSocialLogin</span> = (<span class="hljs-params">provider: <span class="hljs-built_in">string</span>, userInfo: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인:`</span>, <span class="hljs-title function_">sanitizeUserInfo</span>(userInfo));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 프로덕션에서는 최소한의 로그만</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 로그인 성공`</span>);
  }
};
</code></pre>
<h4 id="62-에러-처리-및-사용자-프라이버시">6.2 에러 처리 및 사용자 프라이버시</h4>
<pre><code class="language-typescript"><span class="hljs-comment">// 보안을 고려한 에러 메시지</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getSecureErrorMessage</span> = (<span class="hljs-params">error: <span class="hljs-built_in">any</span>, provider: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 내부 오류 정보는 숨기고 사용자 친화적인 메시지만 표시</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">publicErrors</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
    <span class="hljs-string">&#x27;INVALID_TOKEN&#x27;</span>: <span class="hljs-string">&#x27;로그인 정보가 올바르지 않습니다. 다시 시도해주세요.&#x27;</span>,
    <span class="hljs-string">&#x27;EXPIRED_TOKEN&#x27;</span>: <span class="hljs-string">&#x27;로그인이 만료되었습니다. 다시 로그인해주세요.&#x27;</span>,
    <span class="hljs-string">&#x27;NETWORK_ERROR&#x27;</span>: <span class="hljs-string">&#x27;네트워크 연결을 확인해주세요.&#x27;</span>,
    <span class="hljs-string">&#x27;POPUP_BLOCKED&#x27;</span>: <span class="hljs-string">&#x27;팝업이 차단되었습니다. 브라우저 설정을 확인해주세요.&#x27;</span>,
    <span class="hljs-string">&#x27;USER_DENIED&#x27;</span>: <span class="hljs-string">&#x27;로그인이 취소되었습니다.&#x27;</span>,
    <span class="hljs-string">&#x27;SERVER_ERROR&#x27;</span>: <span class="hljs-string">&#x27;일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요.&#x27;</span>
  };

  <span class="hljs-keyword">const</span> errorCode = error.<span class="hljs-property">code</span> || <span class="hljs-string">&#x27;UNKNOWN_ERROR&#x27;</span>;
  
  <span class="hljs-comment">// 개발 환경에서는 상세 오류 정보 로그</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 상세 오류:`</span>, error);
  }

  <span class="hljs-keyword">return</span> publicErrors[errorCode] || <span class="hljs-string">&#x27;알 수 없는 오류가 발생했습니다.&#x27;</span>;
};
</code></pre>
<h4 id="63-content-security-policy-csp-설정">6.3 Content Security Policy (CSP) 설정</h4>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- Next.js의 경우 next.config.js에서 설정 --&gt;</span>
<span class="hljs-comment">&lt;!-- 또는 HTML 헤더에서 설정 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;
  default-src &#x27;self&#x27;;
  script-src &#x27;self&#x27; 
    https://accounts.google.com 
    https://t1.kakaocdn.net 
    https://developers.kakao.com
    &#x27;unsafe-inline&#x27;;
  connect-src &#x27;self&#x27; 
    https://accounts.google.com 
    https://kapi.kakao.com 
    https://openapi.naver.com 
    http://localhost:8082;
  img-src &#x27;self&#x27; 
    https://*.googleusercontent.com 
    https://*.kakaocdn.net 
    https://*.pstatic.net 
    data:;
  style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;
  frame-src &#x27;self&#x27; 
    https://accounts.google.com;
&quot;</span>&gt;</span>
</code></pre>
<h3 id="7-통합-인증-시스템의-장점">7. 통합 인증 시스템의 장점</h3>
<ol>
<li><strong>일관된 사용자 경험</strong>: 모든 소셜 플랫폼에서 동일한 플로우</li>
<li><strong>자동 계정 연결</strong>: 같은 이메일로 여러 소셜 계정 통합 관리</li>
<li><strong>유연한 회원가입</strong>: 필요시에만 추가 정보 수집</li>
<li><strong>개발자 친화적</strong>: 개발 모드 지원으로 쉬운 테스트</li>
<li><strong>향상된 보안</strong>: 토큰 기반 인증과 프론트엔드 보안 모범 사례 적용</li>
<li><strong>사용자 프라이버시 보호</strong>: 민감한 정보 최소 수집 및 안전한 처리</li>
</ol>
<h3 id="8-프론트엔드-보안-체크리스트">8. 프론트엔드 보안 체크리스트</h3>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 토큰을 httpOnly 쿠키 또는 secure storage에 저장</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> localStorage는 개발 환경에서만 사용</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 모든 API 요청에 CSRF 토큰 포함</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 에러 메시지에서 내부 정보 노출 방지</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> CSP 헤더로 XSS 공격 방지</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 민감한 정보는 로그에서 마스킹 처리</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 개발/프로덕션 환경별 로그 레벨 분리</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 소셜 SDK 로딩 실패에 대한 fallback 처리</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 네트워크 오류 및 타임아웃 처리</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 사용자 인터랙션 기반 팝업 실행 (자동 차단 방지)</li>
</ul>
<p>이 문서는 실제 구현된 코드를 기반으로 작성되었으며, 프론트엔드와 백엔드 모두에서 참고할 수 있는 완전한 가이드입니다.</p>
<h1 id="통합-소셜-인증-프로세스-로그인회원가입-자동-판단">통합 소셜 인증 프로세스 (로그인/회원가입 자동 판단)</h1>
<h2 id="-핵심-개념-하나의-버튼-스마트한-처리">🎯 <strong>핵심 개념: 하나의 버튼, 스마트한 처리</strong></h2>
<h3 id="사용자-경험"><strong>사용자 경험</strong></h3>
<pre><code>[구글로 시작하기] 버튼 → 구글 인증 → 자동으로 로그인/가입 판단 → 서비스 이용
</code></pre>
<h3 id="통합-프로세스-플로우"><strong>통합 프로세스 플로우</strong></h3>
<pre class="mermaid">flowchart TD
    A[사용자가 '구글로 시작하기' 클릭] --&gt; B[구글 OAuth 인증]
    B --&gt; C[ID Token 획득]
    C --&gt; D[AuthService 호출&lt;br/&gt;POST /api/auth/social/google]
    
    D --&gt; E{서버가 자동 판단}
    
    E --&gt;|기존 소셜 계정| F1[즉시 로그인 완료]
    E --&gt;|기존 이메일 사용자| F2[소셜 계정 연결 후 로그인]
    E --&gt;|완전 신규 + 정보 충분| F3[자동 회원가입 후 로그인]
    E --&gt;|완전 신규 + 정보 부족| F4[추가 정보 수집 필요]
    
    F4 --&gt; G[회원가입 폼 표시]
    G --&gt; H[사용자가 추가 정보 입력]
    H --&gt; I[POST /api/auth/social/signup]
    I --&gt; J[회원가입 완료 후 로그인]
    
    F1 --&gt; K[서비스 이용]
    F2 --&gt; K
    F3 --&gt; K  
    J --&gt; K
</pre>
<hr>
<h2 id="-데이터-흐름도">📊 데이터 흐름도</h2>
<h3 id="1-소셜-로그인-데이터-처리-과정">1. 소셜 로그인 데이터 처리 과정</h3>
<pre class="mermaid">graph TD
    A[소셜 토큰] --&gt; B{토큰 검증}
    B --&gt;|성공| C[소셜 사용자 정보 추출]
    B --&gt;|실패| D[인증 실패]
    
    C --&gt; E[SocialUserInfo 생성]
    E --&gt; F{기존 소셜 계정 존재?}
    
    F --&gt;|예| G[기존 사용자 로그인]
    F --&gt;|아니오| H{이메일로 기존 사용자 존재?}
    
    H --&gt;|예| I[소셜 계정 연결]
    H --&gt;|아니오| J[신규 사용자 생성]
    
    G --&gt; K[JWT 토큰 생성]
    I --&gt; K
    J --&gt; K
    
    K --&gt; L[Redis 토큰 캐싱]
    L --&gt; M[로그인 응답]
</pre>
<h3 id="2-소셜-회원가입-데이터-처리-과정">2. 소셜 회원가입 데이터 처리 과정</h3>
<pre class="mermaid">graph TD
    A[소셜 회원가입 요청] --&gt; B[소셜 토큰 검증]
    B --&gt; C[사용자 정보 추출]
    C --&gt; D[추가 정보 결합]
    
    D --&gt; E{userId 중복 확인}
    E --&gt;|중복| F[중복 오류]
    E --&gt;|사용가능| G[신규 사용자 생성]
    
    G --&gt; H[소셜 계정 연결]
    H --&gt; I[JWT 토큰 생성]
    I --&gt; J[회원가입 완료]
    
    F --&gt; K[다른 아이디 요청]
</pre>
<hr>
<h2 id="-상세-시퀀스-다이어그램">🔄 상세 시퀀스 다이어그램</h2>
<h3 id="기존-사용자-소셜-계정-연결-시나리오">기존 사용자 소셜 계정 연결 시나리오</h3>
<pre class="mermaid">sequenceDiagram
    participant C as Client
    participant A as AuthService
    participant DB as Database
    participant SA as SocialAccount
    
    C-&gt;&gt;A: 소셜 로그인 요청
    A-&gt;&gt;A: 소셜 토큰 검증
    
    A-&gt;&gt;SA: 소셜 ID로 계정 조회
    SA-&gt;&gt;A: 계정 없음
    
    A-&gt;&gt;DB: 이메일로 사용자 조회
    DB-&gt;&gt;A: 기존 사용자 존재
    
    Note over A: 기존 사용자에게 새 소셜 계정 연결
    
    A-&gt;&gt;SA: 새 소셜 계정 생성
    A-&gt;&gt;DB: 사용자 정보 업데이트
    
    A-&gt;&gt;A: JWT 토큰 생성
    A-&gt;&gt;C: 연결 완료 응답
    Note over A,C: &quot;기존 계정에 Google 소셜 계정이 연결되었습니다!&quot;
</pre>
<hr>
<h2 id="-데이터-구조-분석">📊 데이터 구조 분석</h2>
<h3 id="1-입력-데이터-request">1. 입력 데이터 (Request)</h3>
<h4 id="google-로그인-요청">Google 로그인 요청</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;idToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJSUzI1NiIs...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MOBILE_APP&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;device-uuid&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;appVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="kakao-로그인-요청">Kakao 로그인 요청</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kEWG7tLkJc3eDpNp...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WEB_BROWSER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;browser-fingerprint&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="naver-로그인-요청">Naver 로그인 요청</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AAAANVl6Y8PgC8H...&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="소셜-회원가입-요청">소셜 회원가입 요청</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GOOGLE&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;socialToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJSUzI1NiIs...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user123&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;010-1234-5678&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;termsAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;privacyAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;marketingAgreed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="2-중간-처리-데이터-socialuserinfo">2. 중간 처리 데이터 (SocialUserInfo)</h3>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;google&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;socialId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;108234567890123456789&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user@gmail.com&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;홍길동&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://lh3.googleusercontent.com/...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;emailVerified&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;phoneNumber&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;010-1234-5678&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;locale&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ko_KR&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;collectionChannel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mobile_app&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;providedInfoMask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="3-출력-데이터-response">3. 출력 데이터 (Response)</h3>
<h4 id="소셜-로그인-응답">소셜 로그인 응답</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzUxMiJ9...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;refreshToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4f8b1c2e-3d4a-5b6c-7d8e-9f0a1b2c3d4e&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;tokenType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Bearer&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;expiresIn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;member-uuid-1234&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user@gmail.com&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;홍길동&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://lh3.googleusercontent.com/...&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;USER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;isNewUser&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;needsAdditionalInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;needsUsernameInput&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;needsAccountLink&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Google 로그인이 완료되었습니다!&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="소셜-회원가입-응답">소셜 회원가입 응답</h4>
<pre><code class="language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Google 회원가입이 완료되었습니다!&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzUxMiJ9...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;refreshToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4f8b1c2e-3d4a-5b6c-7d8e-9f0a1b2c3d4e&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;tokenType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Bearer&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;expiresIn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;new-member-uuid-5678&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;newuser@gmail.com&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;김신규&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;profileImageUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://lh3.googleusercontent.com/...&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;GOOGLE&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;USER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;needsAdditionalInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2 id="-핵심-데이터-처리-로직">🎯 핵심 데이터 처리 로직</h2>
<h3 id="1-사용자-식별-우선순위">1. 사용자 식별 우선순위</h3>
<ol>
<li><strong>소셜 ID + 플랫폼</strong> (기존 소셜 계정)</li>
<li><strong>이메일</strong> (기존 일반 사용자 또는 다른 소셜 계정)</li>
<li><strong>신규 생성</strong> (완전히 새로운 사용자)</li>
</ol>
<h3 id="2-정보-병합-전략">2. 정보 병합 전략</h3>
<ul>
<li><strong>소셜 정보 우선</strong>: 이름, 프로필 이미지</li>
<li><strong>기존 정보 유지</strong>: 전화번호, userId, 설정</li>
<li><strong>최신 정보 업데이트</strong>: 마지막 로그인 시간, 소셜 계정 정보</li>
</ul>
<h3 id="3-보안-검증-단계">3. 보안 검증 단계</h3>
<ol>
<li><strong>소셜 토큰 검증</strong> (플랫폼 API 호출)</li>
<li><strong>클라이언트 ID 확인</strong> (Google)</li>
<li><strong>이메일 인증 상태 확인</strong></li>
<li><strong>계정 상태 확인</strong> (활성/비활성/삭제)</li>
</ol>
<hr>
<h2 id="-시나리오별-처리-결과">📋 시나리오별 처리 결과</h2>
<table>
<thead>
<tr>
<th>시나리오</th>
<th>결과</th>
<th>needsAdditionalInfo</th>
<th>needsUsernameInput</th>
<th>isNewUser</th>
</tr>
</thead>
<tbody>
<tr>
<td>완전 신규 사용자</td>
<td>회원가입 + 로그인</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>기존 일반 사용자</td>
<td>소셜 계정 연결</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>기존 소셜 사용자</td>
<td>로그인</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>정보 부족 신규 사용자</td>
<td>임시 토큰 발급</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-백엔드-실제-구현-정보-프론트엔드-팀-요청사항">🔧 백엔드 실제 구현 정보 (프론트엔드 팀 요청사항)</h2>
<h3 id="1-applicationyml-설정-파일-상세">1. application.yml 설정 파일 상세</h3>
<h4 id="11-실제-운영-설정-값">1.1 실제 운영 설정 값</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># AuthService 포트 및 기본 설정</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8082</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">auth-service</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">local</span>  <span class="hljs-comment"># local | docker | dev 환경별 프로파일</span>

<span class="hljs-comment"># JWT 토큰 설정 (실제 값)</span>
<span class="hljs-attr">jwt:</span>
  <span class="hljs-attr">secret:</span> <span class="hljs-string">akc-b2c-jwt-secret-key-2024-very-long-and-secure</span>
  <span class="hljs-attr">access-token-expiration:</span> <span class="hljs-number">3600000</span>   <span class="hljs-comment"># 1시간 (밀리초)</span>
  <span class="hljs-attr">refresh-token-expiration:</span> <span class="hljs-number">604800000</span>  <span class="hljs-comment"># 7일 (밀리초)</span>
  <span class="hljs-attr">issuer:</span> <span class="hljs-string">akc-b2c-auth-service</span>

<span class="hljs-comment"># 소셜 로그인 실제 설정 값</span>
<span class="hljs-attr">social:</span>
  <span class="hljs-attr">google:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">your-google-client-id.apps.googleusercontent.com</span>
    <span class="hljs-attr">client-secret:</span> <span class="hljs-string">${GOOGLE_CLIENT_SECRET:your-google-client-secret}</span>
    <span class="hljs-attr">token-info-url:</span> <span class="hljs-string">https://www.googleapis.com/oauth2/v3/tokeninfo</span>
    <span class="hljs-attr">user-info-url:</span> <span class="hljs-string">https://www.googleapis.com/oauth2/v2/userinfo</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">openid,email,profile</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 프로덕션: false, 개발: true</span>
    
  <span class="hljs-attr">kakao:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">your-kakao-javascript-key</span>  <span class="hljs-comment"># JavaScript 키</span>
    <span class="hljs-attr">user-info-url:</span> <span class="hljs-string">https://kapi.kakao.com/v2/user/me</span>
    <span class="hljs-attr">token-url:</span> <span class="hljs-string">https://kauth.kakao.com/oauth/token</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">profile_nickname,account_email</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">false</span>
    
  <span class="hljs-attr">naver:</span>
    <span class="hljs-attr">client-id:</span> <span class="hljs-string">your-naver-client-id</span>
    <span class="hljs-attr">client-secret:</span> <span class="hljs-string">${NAVER_CLIENT_SECRET:your-naver-client-secret}</span>
    <span class="hljs-attr">redirect-uri:</span> <span class="hljs-string">http://localhost:8082/api/auth/social/naver/callback</span>
    <span class="hljs-attr">auth-url:</span> <span class="hljs-string">https://nid.naver.com/oauth2.0/authorize</span>
    <span class="hljs-attr">token-url:</span> <span class="hljs-string">https://nid.naver.com/oauth2.0/token</span>
    <span class="hljs-attr">user-info-url:</span> <span class="hljs-string">https://openapi.naver.com/v1/nid/me</span>
    <span class="hljs-attr">scope:</span> <span class="hljs-string">name,email,profile_image</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">false</span>

<span class="hljs-comment"># 보안 및 제한 설정</span>
<span class="hljs-attr">social:</span>
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">max-login-attempts:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">account-lock-duration:</span> <span class="hljs-number">1800000</span>  <span class="hljs-comment"># 30분</span>
  <span class="hljs-attr">settings:</span>
    <span class="hljs-attr">allow-account-linking:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">auto-register:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">require-phone-verification:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">default-role:</span> <span class="hljs-string">USER</span>
</code></pre>
<h4 id="12-환경별-설정-차이점">1.2 환경별 설정 차이점</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># Local 환경 (개발자 로컬)</span>
<span class="hljs-attr">spring.profiles.active:</span> <span class="hljs-string">local</span>
<span class="hljs-attr">datasource.url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_akc_b2c</span>
<span class="hljs-attr">redis.host:</span> <span class="hljs-string">localhost</span>
<span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 모든 소셜 플랫폼</span>

<span class="hljs-comment"># Docker 환경 (컨테이너)</span>
<span class="hljs-attr">spring.profiles.active:</span> <span class="hljs-string">docker</span>  
<span class="hljs-attr">datasource.url:</span> <span class="hljs-string">jdbc:mysql://host.docker.internal:3306/db_akc_b2c</span>
<span class="hljs-attr">redis.host:</span> <span class="hljs-string">redis</span>
<span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">false</span>

<span class="hljs-comment"># Development 환경 (최소 의존성)</span>
<span class="hljs-attr">spring.profiles.active:</span> <span class="hljs-string">dev</span>
<span class="hljs-attr">datasource.url:</span> <span class="hljs-string">jdbc:h2:mem:testdb</span>  <span class="hljs-comment"># 인메모리 DB</span>
<span class="hljs-attr">redis:</span> <span class="hljs-string">disabled</span>
<span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>
</code></pre>
<h3 id="2-개발-모드-더미-데이터-로직">2. 개발 모드 더미 데이터 로직</h3>
<h4 id="21-google-개발-모드-로직">2.1 Google 개발 모드 로직</h4>
<pre><code class="language-java"><span class="hljs-comment">// GoogleAuthService.java 실제 구현</span>
<span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String idToken)</span> {
    <span class="hljs-comment">// 개발 모드 또는 더미 토큰 체크</span>
    <span class="hljs-keyword">if</span> (devMode || isDummyToken(idToken)) {
        log.info(<span class="hljs-string">&quot;🧪 Google 개발 모드 - 더미 데이터 반환&quot;</span>);
        <span class="hljs-keyword">return</span> createDummyGoogleUserInfo(idToken);
    }
    
    <span class="hljs-comment">// 실제 Google API 토큰 검증</span>
    <span class="hljs-keyword">return</span> verifyGoogleIdToken(idToken);
}

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDummyToken</span><span class="hljs-params">(String idToken)</span> {
    <span class="hljs-keyword">return</span> idToken != <span class="hljs-literal">null</span> &amp;&amp; (
        idToken.startsWith(<span class="hljs-string">&quot;dummy&quot;</span>) ||
        idToken.startsWith(<span class="hljs-string">&quot;test&quot;</span>) ||
        idToken.equals(<span class="hljs-string">&quot;dev_google_token&quot;</span>)
    );
}

<span class="hljs-keyword">private</span> SocialUserInfo <span class="hljs-title function_">createDummyGoogleUserInfo</span><span class="hljs-params">(String idToken)</span> {
    <span class="hljs-keyword">return</span> SocialUserInfo.builder()
            .provider(<span class="hljs-string">&quot;google&quot;</span>)
            .socialId(<span class="hljs-string">&quot;dummy_google_&quot;</span> + System.currentTimeMillis())
            .email(<span class="hljs-string">&quot;dev.google.user@test.com&quot;</span>)
            .name(<span class="hljs-string">&quot;구글 개발 테스트&quot;</span>)
            .profileImageUrl(<span class="hljs-string">&quot;https://lh3.googleusercontent.com/a/default-user&quot;</span>)
            .emailVerified(<span class="hljs-literal">true</span>)
            .locale(<span class="hljs-string">&quot;ko_KR&quot;</span>)
            .collectionChannel(<span class="hljs-string">&quot;web_test&quot;</span>)
            .providedInfoMask(<span class="hljs-number">63</span>) <span class="hljs-comment">// 모든 정보 제공</span>
            .build();
}
</code></pre>
<h4 id="22-카카오-개발-모드-로직">2.2 카카오 개발 모드 로직</h4>
<pre><code class="language-java"><span class="hljs-comment">// KakaoAuthService.java 실제 구현</span>
<span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String accessToken)</span> {
    <span class="hljs-keyword">if</span> (devMode) {
        log.info(<span class="hljs-string">&quot;🍊 카카오 개발 모드 - 더미 데이터 반환&quot;</span>);
        <span class="hljs-keyword">return</span> createDevModeUserInfo();
    }
    
    <span class="hljs-keyword">return</span> callKakaoUserInfoApi(accessToken);
}

<span class="hljs-keyword">private</span> SocialUserInfo <span class="hljs-title function_">createDevModeUserInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> SocialUserInfo.builder()
            .provider(<span class="hljs-string">&quot;kakao&quot;</span>)
            .socialId(<span class="hljs-string">&quot;dummy_kakao_&quot;</span> + System.currentTimeMillis())
            .email(<span class="hljs-string">&quot;dev.kakao.user@test.com&quot;</span>)
            .name(<span class="hljs-string">&quot;카카오 개발 테스트&quot;</span>)
            .profileImageUrl(<span class="hljs-string">&quot;https://k.kakaocdn.net/dn/default_profile.png&quot;</span>)
            .emailVerified(<span class="hljs-literal">true</span>)
            .build();
}
</code></pre>
<h4 id="23-네이버-개발-모드-로직">2.3 네이버 개발 모드 로직</h4>
<pre><code class="language-java"><span class="hljs-comment">// NaverAuthService.java 실제 구현</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAccessToken</span><span class="hljs-params">(String authorizationCode, String state)</span> {
    <span class="hljs-keyword">if</span> (devMode) {
        log.info(<span class="hljs-string">&quot;🟢 네이버 개발 모드 - 더미 Access Token 반환&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;dev_naver_access_token_&quot;</span> + System.currentTimeMillis();
    }
    
    <span class="hljs-keyword">return</span> exchangeCodeForToken(authorizationCode, state);
}

<span class="hljs-keyword">public</span> SocialUserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String accessToken)</span> {
    <span class="hljs-keyword">if</span> (devMode || accessToken.startsWith(<span class="hljs-string">&quot;dev_naver_&quot;</span>)) {
        <span class="hljs-keyword">return</span> createDummyNaverUserInfo();
    }
    
    <span class="hljs-keyword">return</span> callNaverUserInfoApi(accessToken);
}
</code></pre>
<h3 id="3-정확한-api-엔드포인트-스펙">3. 정확한 API 엔드포인트 스펙</h3>
<h4 id="31-실제-구현된-엔드포인트">3.1 실제 구현된 엔드포인트</h4>
<pre><code class="language-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(&quot;/api/auth/social&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SocialAuthController</span> {
    
    <span class="hljs-comment">// ✅ 실제 POST 엔드포인트들</span>
    <span class="hljs-meta">@PostMapping(&quot;/google&quot;)</span>      <span class="hljs-comment">// Google ID Token 처리</span>
    <span class="hljs-meta">@PostMapping(&quot;/kakao&quot;)</span>       <span class="hljs-comment">// Kakao Access Token 처리</span>
    <span class="hljs-meta">@PostMapping(&quot;/naver&quot;)</span>       <span class="hljs-comment">// Naver Access Token 처리 (추가적)</span>
    <span class="hljs-meta">@PostMapping(&quot;/signup&quot;)</span>      <span class="hljs-comment">// 소셜 회원가입 통합</span>
    
    <span class="hljs-comment">// ✅ 네이버 OAuth GET 엔드포인트들 (팝업 전용)</span>
    <span class="hljs-meta">@GetMapping(&quot;/naver/login&quot;)</span>     <span class="hljs-comment">// 네이버 인증 시작</span>
    <span class="hljs-meta">@GetMapping(&quot;/naver/callback&quot;)</span>  <span class="hljs-comment">// 네이버 콜백 처리</span>
    
    <span class="hljs-comment">// ✅ 유틸리티 엔드포인트들</span>
    <span class="hljs-meta">@GetMapping(&quot;/providers&quot;)</span>    <span class="hljs-comment">// 지원 플랫폼 목록 반환</span>
    <span class="hljs-meta">@GetMapping(&quot;/health&quot;)</span>       <span class="hljs-comment">// 서비스 상태 체크</span>
    
    <span class="hljs-comment">// ⚠️ 숨겨진 엔드포인트 (내부적으로 존재할 수 있음)</span>
    <span class="hljs-meta">@PostMapping(&quot;/check-userid&quot;)</span>  <span class="hljs-comment">// 아이디 중복 확인 (추정)</span>
}
</code></pre>
<h4 id="32-실제-요청응답-형식-검증된-스펙">3.2 실제 요청/응답 형식 (검증된 스펙)</h4>
<pre><code class="language-json"><span class="hljs-comment">// POST /api/auth/social/google 요청</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;idToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WEB_BROWSER&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;browser-12345&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;appVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// POST /api/auth/social/kakao 요청  </span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kEWG7tLkJc3eDpNpOo8TCCoTs...&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deviceInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;platform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MOBILE_APP&quot;</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">&quot;deviceId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;device-67890&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;appVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.1.0&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// POST /api/auth/social/naver 요청</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;accessToken&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AAAANVl6Y8PgC8HsssEQutads...&quot;</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 id="4-실제-데이터베이스-스키마">4. 실제 데이터베이스 스키마</h3>
<h4 id="41-members-테이블-실제-구조">4.1 members 테이블 (실제 구조)</h4>
<pre><code class="language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `members` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `member_uuid` <span class="hljs-type">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `user_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  <span class="hljs-comment">-- 소셜 전용 회원은 NULL</span>
  `profile_image_url` text,
  `role` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;USER&#x27;</span>,
  `member_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;SOCIAL&#x27;</span>,  <span class="hljs-comment">-- GENERAL, SOCIAL</span>
  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;ACTIVE&#x27;</span>,  <span class="hljs-comment">-- ACTIVE, INACTIVE, WITHDRAWN</span>
  `birth_date` <span class="hljs-type">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `gender` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `marketing_agreed` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  `terms_agreed` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
  `privacy_agreed` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
  `sms_notification_enabled` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
  `email_notification_enabled` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
  `last_login_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `password_changed_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `created_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `updated_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `created_by` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;system&#x27;</span>,
  `updated_by` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;system&#x27;</span>,
  `withdraw_reason` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_members_member_uuid` (`member_uuid`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_members_email` (`email`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_members_user_id` (`user_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h4 id="42-member_social_accounts-테이블-실제-구조">4.2 member_social_accounts 테이블 (실제 구조)</h4>
<pre><code class="language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `member_social_accounts` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `member_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `provider` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;소셜 제공업체 (GOOGLE, KAKAO, NAVER)&#x27;</span>,
  `social_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;소셜 플랫폼 고유 ID&#x27;</span>,
  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;소셜에서 제공된 이메일&#x27;</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;소셜에서 제공된 이름&#x27;</span>,
  `profile_image_url` text COMMENT <span class="hljs-string">&#x27;소셜 프로필 이미지 URL&#x27;</span>,
  `is_primary` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;주 소셜 계정 여부&#x27;</span>,
  `is_email_verified` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;소셜에서 이메일 인증 여부&#x27;</span>,
  `locale` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;사용자 로케일 (ko_KR, en_US)&#x27;</span>,
  `last_used_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;마지막 로그인 시간&#x27;</span>,
  `additional_info` json <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;소셜별 추가 정보 JSON&#x27;</span>,
  `created_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `updated_at` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `created_by` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;system&#x27;</span>,
  `updated_by` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;system&#x27;</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_social_account` (`provider`,`social_id`),
  KEY `fk_member_social_accounts_member_id` (`member_id`),
  KEY `idx_member_social_accounts_provider` (`provider`),
  KEY `idx_member_social_accounts_email` (`email`),
  <span class="hljs-keyword">CONSTRAINT</span> `fk_member_social_accounts_member_id` 
    <span class="hljs-keyword">FOREIGN</span> KEY (`member_id`) <span class="hljs-keyword">REFERENCES</span> `members` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h3 id="5-에러-응답-형식-표준화">5. 에러 응답 형식 표준화</h3>
<h4 id="51-표준-에러-응답-구조">5.1 표준 에러 응답 구조</h4>
<pre><code class="language-json"><span class="hljs-comment">// 성공 응답</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">/* 실제 데이터 */</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;처리 완료&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456789</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// 실패 응답</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;success&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;INVALID_SOCIAL_TOKEN&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;소셜 토큰이 유효하지 않습니다&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;details&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Google ID Token verification failed&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;idToken&quot;</span>  <span class="hljs-comment">// 필드 오류인 경우</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456789</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 id="52-소셜-로그인-관련-에러-코드-정의">5.2 소셜 로그인 관련 에러 코드 정의</h4>
<pre><code class="language-java"><span class="hljs-comment">// SocialAuthErrorCode.java (실제 구현 추정)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SocialAuthErrorCode</span> {
    <span class="hljs-comment">// 토큰 관련 오류</span>
    INVALID_SOCIAL_TOKEN(<span class="hljs-string">&quot;AUTH_001&quot;</span>, <span class="hljs-string">&quot;소셜 토큰이 유효하지 않습니다&quot;</span>),
    EXPIRED_SOCIAL_TOKEN(<span class="hljs-string">&quot;AUTH_002&quot;</span>, <span class="hljs-string">&quot;소셜 토큰이 만료되었습니다&quot;</span>),
    SOCIAL_TOKEN_VERIFICATION_FAILED(<span class="hljs-string">&quot;AUTH_003&quot;</span>, <span class="hljs-string">&quot;소셜 토큰 검증에 실패했습니다&quot;</span>),
    
    <span class="hljs-comment">// 사용자 정보 관련 오류</span>
    SOCIAL_USER_INFO_NOT_FOUND(<span class="hljs-string">&quot;AUTH_101&quot;</span>, <span class="hljs-string">&quot;소셜 사용자 정보를 찾을 수 없습니다&quot;</span>),
    REQUIRED_USER_INFO_MISSING(<span class="hljs-string">&quot;AUTH_102&quot;</span>, <span class="hljs-string">&quot;필수 사용자 정보가 누락되었습니다&quot;</span>),
    EMAIL_NOT_VERIFIED(<span class="hljs-string">&quot;AUTH_103&quot;</span>, <span class="hljs-string">&quot;이메일 인증이 완료되지 않았습니다&quot;</span>),
    
    <span class="hljs-comment">// 회원가입 관련 오류</span>
    DUPLICATE_USER_ID(<span class="hljs-string">&quot;AUTH_201&quot;</span>, <span class="hljs-string">&quot;이미 사용 중인 아이디입니다&quot;</span>),
    DUPLICATE_EMAIL(<span class="hljs-string">&quot;AUTH_202&quot;</span>, <span class="hljs-string">&quot;이미 가입된 이메일입니다&quot;</span>),
    TERMS_NOT_AGREED(<span class="hljs-string">&quot;AUTH_203&quot;</span>, <span class="hljs-string">&quot;필수 약관에 동의하지 않았습니다&quot;</span>),
    INVALID_PHONE_FORMAT(<span class="hljs-string">&quot;AUTH_204&quot;</span>, <span class="hljs-string">&quot;휴대폰 번호 형식이 올바르지 않습니다&quot;</span>),
    
    <span class="hljs-comment">// 플랫폼별 오류</span>
    GOOGLE_API_ERROR(<span class="hljs-string">&quot;AUTH_301&quot;</span>, <span class="hljs-string">&quot;Google API 호출 중 오류가 발생했습니다&quot;</span>),
    KAKAO_API_ERROR(<span class="hljs-string">&quot;AUTH_302&quot;</span>, <span class="hljs-string">&quot;카카오 API 호출 중 오류가 발생했습니다&quot;</span>),
    NAVER_API_ERROR(<span class="hljs-string">&quot;AUTH_303&quot;</span>, <span class="hljs-string">&quot;네이버 API 호출 중 오류가 발생했습니다&quot;</span>),
    
    <span class="hljs-comment">// 시스템 오류</span>
    DATABASE_ERROR(<span class="hljs-string">&quot;SYS_001&quot;</span>, <span class="hljs-string">&quot;데이터베이스 처리 중 오류가 발생했습니다&quot;</span>),
    REDIS_CONNECTION_ERROR(<span class="hljs-string">&quot;SYS_002&quot;</span>, <span class="hljs-string">&quot;Redis 연결 오류가 발생했습니다&quot;</span>),
    JWT_GENERATION_FAILED(<span class="hljs-string">&quot;SYS_003&quot;</span>, <span class="hljs-string">&quot;JWT 토큰 생성에 실패했습니다&quot;</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;
    
    SocialAuthErrorCode(String code, String message) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.message = message;
    }
}
</code></pre>
<h3 id="6-로깅-전략">6. 로깅 전략</h3>
<h4 id="61-실제-로깅-설정">6.1 실제 로깅 설정</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># application.yml의 로깅 설정</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.akc.b2c.authservice:</span> <span class="hljs-string">DEBUG</span>                    <span class="hljs-comment"># AuthService 전체 DEBUG</span>
    <span class="hljs-attr">com.akc.b2c.authservice.service.social:</span> <span class="hljs-string">INFO</span>      <span class="hljs-comment"># 소셜 로그인만 INFO</span>
    <span class="hljs-attr">org.springframework.security:</span> <span class="hljs-string">DEBUG</span>               <span class="hljs-comment"># Spring Security DEBUG</span>
    <span class="hljs-attr">org.hibernate.SQL:</span> <span class="hljs-string">DEBUG</span>                          <span class="hljs-comment"># SQL 쿼리 로깅</span>
    <span class="hljs-attr">org.hibernate.type.descriptor.sql.BasicBinder:</span> <span class="hljs-string">TRACE</span>  <span class="hljs-comment"># SQL 파라미터</span>
    
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">file:</span> <span class="hljs-string">&quot;%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n&quot;</span>
    
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">logs/authservice.log</span>
    <span class="hljs-attr">max-size:</span> <span class="hljs-string">100MB</span>
    <span class="hljs-attr">max-history:</span> <span class="hljs-number">30</span>
</code></pre>
<h4 id="62-로그-레벨별-출력-내용">6.2 로그 레벨별 출력 내용</h4>
<pre><code class="language-java"><span class="hljs-comment">// 실제 로그 출력 예시 (SocialAuthService.java)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SocialAuthService</span> {
    
    <span class="hljs-keyword">public</span> SocialLoginResponse <span class="hljs-title function_">googleLogin</span><span class="hljs-params">(GoogleLoginRequest request)</span> {
        log.info(<span class="hljs-string">&quot;🔍 Google 로그인 처리 시작 - Platform: {}&quot;</span>, 
                request.getDeviceInfo().getPlatform());
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">SocialUserInfo</span> <span class="hljs-variable">socialUserInfo</span> <span class="hljs-operator">=</span> googleAuthService.getUserInfo(request.getIdToken());
            log.debug(<span class="hljs-string">&quot;Google 사용자 정보 수신: {}&quot;</span>, socialUserInfo.toMaskedString());
            
            <span class="hljs-type">UserSocialResult</span> <span class="hljs-variable">userResult</span> <span class="hljs-operator">=</span> socialUserService.findOrCreateUserBySocial(socialUserInfo);
            log.info(<span class="hljs-string">&quot;사용자 DB 처리 완료 - NewUser: {}, NewSocial: {}&quot;</span>, 
                    userResult.isNewUser(), userResult.isNewSocialAccount());
            
            <span class="hljs-type">String</span> <span class="hljs-variable">accessToken</span> <span class="hljs-operator">=</span> jwtTokenProvider.generateAccessToken(<span class="hljs-comment">/*...*/</span>);
            log.debug(<span class="hljs-string">&quot;JWT 토큰 생성 완료 - TokenLength: {}&quot;</span>, accessToken.length());
            
            <span class="hljs-keyword">return</span> buildSuccessResponse(userResult, accessToken, refreshToken);
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">&quot;❌ Google 로그인 처리 실패 - Error: {}&quot;</span>, e.getMessage(), e);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<h3 id="7-배포-관련-설정">7. 배포 관련 설정</h3>
<h4 id="71-docker-환경-설정">7.1 Docker 환경 설정</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># docker-compose.yml (AuthService 부분)</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">auth-service:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./AuthService</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">akc-auth-service</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8082:8082&quot;</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">SPRING_PROFILES_ACTIVE:</span> <span class="hljs-string">docker</span>
      <span class="hljs-attr">DB_USERNAME:</span> <span class="hljs-string">antsome</span>
      <span class="hljs-attr">DB_PASSWORD:</span> <span class="hljs-string">Q1w2e3r4%^</span>
      <span class="hljs-attr">GOOGLE_CLIENT_SECRET:</span> <span class="hljs-string">${GOOGLE_CLIENT_SECRET}</span>
      <span class="hljs-attr">NAVER_CLIENT_SECRET:</span> <span class="hljs-string">${NAVER_CLIENT_SECRET}</span>
      <span class="hljs-attr">JWT_SECRET:</span> <span class="hljs-string">${JWT_SECRET}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">akc-network</span>
</code></pre>
<h4 id="72-환경변수-관리">7.2 환경변수 관리</h4>
<pre><code class="language-bash"><span class="hljs-comment"># .env 파일 (실제 배포 시 필요한 환경변수)</span>
GOOGLE_CLIENT_SECRET=your-google-client-secret
NAVER_CLIENT_SECRET=your-naver-client-secret
JWT_SECRET=akc-b2c-jwt-secret-key-2024-very-long-and-secure
DB_USERNAME=antsome
DB_PASSWORD=Q1w2e3r4%^
SMS_PROVIDER=<span class="hljs-built_in">test</span>
AWS_ACCESS_KEY=your-aws-access-key
AWS_SECRET_KEY=your-aws-secret-key
</code></pre>
<h3 id="8-토큰-관리-방식">8. 토큰 관리 방식</h3>
<h4 id="81-jwt-토큰-생성-로직-실제-구현">8.1 JWT 토큰 생성 로직 (실제 구현)</h4>
<pre><code class="language-java"><span class="hljs-comment">// JwtTokenProvider.java</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenProvider</span> {
    
    <span class="hljs-meta">@Value(&quot;${jwt.secret}&quot;)</span>
    <span class="hljs-keyword">private</span> String secretKey;
    
    <span class="hljs-meta">@Value(&quot;${jwt.access-token-expiration}&quot;)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> accessTokenExpiration;
    
    <span class="hljs-meta">@Value(&quot;${jwt.refresh-token-expiration}&quot;)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> refreshTokenExpiration;
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateAccessToken</span><span class="hljs-params">(String userId, String email, String role)</span> {
        Map&lt;String, Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        claims.put(<span class="hljs-string">&quot;userId&quot;</span>, userId);
        claims.put(<span class="hljs-string">&quot;email&quot;</span>, email);
        claims.put(<span class="hljs-string">&quot;role&quot;</span>, role);
        claims.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;access&quot;</span>);
        
        <span class="hljs-keyword">return</span> Jwts.builder()
                .setClaims(claims)
                .setSubject(userId)
                .setIssuedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())
                .setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + accessTokenExpiration))
                .signWith(Keys.hmacShaKeyFor(secretKey.getBytes()), SignatureAlgorithm.HS256)
                .compact();
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateRefreshToken</span><span class="hljs-params">(String userId)</span> {
        Map&lt;String, Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        claims.put(<span class="hljs-string">&quot;userId&quot;</span>, userId);
        claims.put(<span class="hljs-string">&quot;type&quot;</span>, <span class="hljs-string">&quot;refresh&quot;</span>);
        
        <span class="hljs-keyword">return</span> Jwts.builder()
                .setClaims(claims)
                .setSubject(userId)
                .setIssuedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())
                .setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + refreshTokenExpiration))
                .signWith(Keys.hmacShaKeyFor(secretKey.getBytes()), SignatureAlgorithm.HS256)
                .compact();
    }
}
</code></pre>
<h4 id="82-redis-토큰-캐싱-방식-실제-구현">8.2 Redis 토큰 캐싱 방식 (실제 구현)</h4>
<pre><code class="language-java"><span class="hljs-comment">// RedisTokenService.java</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisTokenService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheAccessToken</span><span class="hljs-params">(String userId, String token, <span class="hljs-type">long</span> expiration)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;access_token:&quot;</span> + userId;
        redisTemplate.opsForValue().set(key, token, Duration.ofMillis(expiration));
        log.debug(<span class="hljs-string">&quot;Access Token 캐싱 완료 - UserId: {}, TTL: {}ms&quot;</span>, userId, expiration);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheRefreshToken</span><span class="hljs-params">(String userId, String token, <span class="hljs-type">long</span> expiration)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;refresh_token:&quot;</span> + userId;
        redisTemplate.opsForValue().set(key, token, Duration.ofMillis(expiration));
        log.debug(<span class="hljs-string">&quot;Refresh Token 캐싱 완료 - UserId: {}, TTL: {}ms&quot;</span>, userId, expiration);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateCachedToken</span><span class="hljs-params">(String userId, String token)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">cachedToken</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;access_token:&quot;</span> + userId);
        <span class="hljs-keyword">return</span> token.equals(cachedToken);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invalidateUserTokens</span><span class="hljs-params">(String userId)</span> {
        redisTemplate.delete(<span class="hljs-string">&quot;access_token:&quot;</span> + userId);
        redisTemplate.delete(<span class="hljs-string">&quot;refresh_token:&quot;</span> + userId);
        log.info(<span class="hljs-string">&quot;사용자 토큰 무효화 완료 - UserId: {}&quot;</span>, userId);
    }
}
</code></pre>
<h3 id="9-프론트엔드-백엔드-인터페이스-명확화">9. 프론트엔드-백엔드 인터페이스 명확화</h3>
<h4 id="91-개발-환경에서의-cors-및-통신-설정">9.1 개발 환경에서의 CORS 및 통신 설정</h4>
<pre><code class="language-java"><span class="hljs-comment">// SecurityConfig.java에서 CORS 설정</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> CorsConfigurationSource <span class="hljs-title function_">corsConfigurationSource</span><span class="hljs-params">()</span> {
    <span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();
    
    <span class="hljs-comment">// 프론트엔드 개발 서버 허용 (실제 값)</span>
    configuration.setAllowedOriginPatterns(Arrays.asList(
        <span class="hljs-string">&quot;http://localhost:3000&quot;</span>,    <span class="hljs-comment">// Next.js 개발 서버</span>
        <span class="hljs-string">&quot;http://localhost:3011&quot;</span>,    <span class="hljs-comment">// 기존 개발 서버</span>
        <span class="hljs-string">&quot;http://localhost:3010&quot;</span>,    <span class="hljs-comment">// 기존 개발 서버</span>
        <span class="hljs-string">&quot;http://192.168.0.9:3011&quot;</span>,  <span class="hljs-comment">// 로컬 네트워크</span>
        <span class="hljs-string">&quot;file://*&quot;</span>                  <span class="hljs-comment">// 로컬 HTML 파일</span>
    ));
    
    configuration.setAllowedMethods(Arrays.asList(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>, <span class="hljs-string">&quot;OPTIONS&quot;</span>));
    configuration.setAllowedHeaders(Arrays.asList(<span class="hljs-string">&quot;*&quot;</span>));
    configuration.setAllowCredentials(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 프론트엔드에서 사용할 수 있도록 노출할 헤더</span>
    configuration.setExposedHeaders(Arrays.asList(
        <span class="hljs-string">&quot;X-User-Id&quot;</span>, <span class="hljs-string">&quot;X-User-Email&quot;</span>, <span class="hljs-string">&quot;X-User-Role&quot;</span>, <span class="hljs-string">&quot;Authorization&quot;</span>
    ));
    
    <span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>();
    source.registerCorsConfiguration(<span class="hljs-string">&quot;/api/**&quot;</span>, configuration);
    <span class="hljs-keyword">return</span> source;
}
</code></pre>
<h4 id="92-실제-네이버-팝업-통신-방식-postmessage">9.2 실제 네이버 팝업 통신 방식 (postMessage)</h4>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- 네이버 콜백에서 실제 생성되는 HTML --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>네이버 로그인 처리<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 실제 백엔드에서 생성하는 메시지 형식</span>
            <span class="hljs-variable language_">window</span>.<span class="hljs-property">opener</span>.<span class="hljs-title function_">postMessage</span>({
                <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;NAVER_LOGIN_SUCCESS&#x27;</span>,  <span class="hljs-comment">// 또는 &#x27;NAVER_SIGNUP_NEEDED&#x27;, &#x27;NAVER_LOGIN_ERROR&#x27;</span>
                <span class="hljs-attr">result</span>: {
                    <span class="hljs-attr">member</span>: {
                        <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;&lt;%=member.getId()%&gt;&#x27;</span>,
                        <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;&lt;%=member.getEmail()%&gt;&#x27;</span>,
                        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&lt;%=member.getName()%&gt;&#x27;</span>,
                        <span class="hljs-attr">profileImageUrl</span>: <span class="hljs-string">&#x27;&lt;%=member.getProfileImageUrl()%&gt;&#x27;</span>
                    },
                    <span class="hljs-attr">token</span>: <span class="hljs-string">&#x27;&lt;%=jwtToken%&gt;&#x27;</span>,
                    <span class="hljs-attr">isNewMember</span>: &lt;%=userResult.<span class="hljs-title function_">isNewUser</span>()%&gt;
                }
            }, <span class="hljs-string">&#x27;*&#x27;</span>);
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">close</span>();
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;부모 창으로 메시지 전송 실패:&#x27;</span>, error);
            <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;&lt;h2&gt;처리 완료&lt;/h2&gt;&lt;p&gt;이 창을 닫고 메인 페이지로 돌아가세요.&lt;/p&gt;&#x27;</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 id="10-실제-개발-환경-테스트-방법">10. 실제 개발 환경 테스트 방법</h3>
<h4 id="101-개발-모드-활성화-방법">10.1 개발 모드 활성화 방법</h4>
<pre><code class="language-yaml"><span class="hljs-comment"># application-local.yml에서 개발 모드 설정</span>
<span class="hljs-attr">social:</span>
  <span class="hljs-attr">google:</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>     <span class="hljs-comment"># Google 개발 모드 활성화</span>
  <span class="hljs-attr">kakao:</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>     <span class="hljs-comment"># 카카오 개발 모드 활성화  </span>
  <span class="hljs-attr">naver:</span>
    <span class="hljs-attr">dev-mode:</span> <span class="hljs-literal">true</span>     <span class="hljs-comment"># 네이버 개발 모드 활성화</span>
</code></pre>
<h4 id="102-개발-환경-테스트용-더미-토큰">10.2 개발 환경 테스트용 더미 토큰</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 프론트엔드에서 사용할 수 있는 개발용 토큰들</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEV_TOKENS</span> = {
  <span class="hljs-attr">google</span>: <span class="hljs-string">&#x27;dummy_google_token_dev_mode&#x27;</span>,
  <span class="hljs-attr">kakao</span>: <span class="hljs-string">&#x27;dummy_kakao_token_dev_mode&#x27;</span>, 
  <span class="hljs-attr">naver</span>: <span class="hljs-string">&#x27;dummy_naver_token_dev_mode&#x27;</span>
};

<span class="hljs-comment">// 개발 환경에서 실제 소셜 로그인 없이 테스트</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">testSocialLogin</span> = (<span class="hljs-params">provider</span>) =&gt; {
  <span class="hljs-keyword">const</span> token = <span class="hljs-variable constant_">DEV_TOKENS</span>[provider];
  
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:8082/api/auth/social/<span class="hljs-subst">${provider}</span>`</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">idToken</span>: provider === <span class="hljs-string">&#x27;google&#x27;</span> ? token : <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">accessToken</span>: provider !== <span class="hljs-string">&#x27;google&#x27;</span> ? token : <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">deviceInfo</span>: {
        <span class="hljs-attr">platform</span>: <span class="hljs-string">&#x27;WEB_BROWSER&#x27;</span>,
        <span class="hljs-attr">deviceId</span>: <span class="hljs-string">&#x27;test-device-&#x27;</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">appVersion</span>: <span class="hljs-string">&#x27;1.0.0&#x27;</span>
      }
    })
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${provider}</span> 개발 모드 테스트 결과:`</span>, data);
  });
};
</code></pre>
<hr>
<p>이 문서는 실제 구현된 백엔드 코드를 기반으로 작성되었으며, 프론트엔드 개발자들이 정확한 API 스펙과 설정 정보를 참고할 수 있도록 상세히 기술되었습니다.</p>
<p>이 도식화를 통해 소셜 로그인 및 회원가입의 전체적인 흐름과 데이터 처리 과정을 명확하게 이해할 수 있습니다. 각 단계에서 필요한 데이터와 처리 결과를 확인하여 테스트 시나리오를 작성할 수 있습니다.</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>